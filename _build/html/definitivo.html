
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ejercicio de Fisioterapia: Modelos &#8212; entregatres</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'definitivo';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Ejercicios de Fisioterapia: EDA" href="segundo_punto.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="entregatres - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="entregatres - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Parcial 3
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Punto1EDA_Parcial3.html">Problema de clasificación</a></li>


<li class="toctree-l1"><a class="reference internal" href="Punto1_Modelos_Parcial3%20%281%29.html">Modelamiento del Conjunto de Datos: Satisfacción de Clientes</a></li>

<li class="toctree-l1"><a class="reference internal" href="segundo_punto.html">Ejercicios de Fisioterapia: EDA</a></li>




<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ejercicio de Fisioterapia: Modelos</a></li>



</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdefinitivo.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/definitivo.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ejercicio de Fisioterapia: Modelos</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Ejercicio de Fisioterapia: Modelos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias">Librerias</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#funciones-para-los-modelos">Funciones para los modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizamos-los-pliegues">Visualizamos los pliegues</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementacion">Implementación</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#knn">KNN</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#los-mejores-modelos">Los mejores modelos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graficas-de-los-residuos">Graficas de los residuos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot">Boxplot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-lineal">Regresion Lineal</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mejores-modelos">Mejores Modelos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#residuos">Residuos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Boxplot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-ridge">Regresion Ridge</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Mejores modelos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Residuos</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-lasso">Regresion Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-random-forest">Regresion Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Residuos</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-xgboost">Regresion XGboost</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ejercicio-de-fisioterapia-modelos">
<h1>Ejercicio de Fisioterapia: Modelos<a class="headerlink" href="#ejercicio-de-fisioterapia-modelos" title="Link to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="librerias">
<h1>Librerias<a class="headerlink" href="#librerias" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">skopt</span> <span class="kn">import</span> <span class="n">BayesSearchCV</span>
<span class="kn">from</span> <span class="nn">skopt.space</span> <span class="kn">import</span> <span class="n">Real</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">LassoCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_absolute_percentage_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="funciones-para-los-modelos">
<h1>Funciones para los modelos<a class="headerlink" href="#funciones-para-los-modelos" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">directorio_principal</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">KELLY</span><span class="se">\\</span><span class="s2">Downloads</span><span class="se">\\</span><span class="s2">fisioterapia_dataset_regresion&quot;</span>

<span class="k">def</span> <span class="nf">cargar_datos_entrenamiento_prueba</span><span class="p">(</span><span class="n">directorio</span><span class="p">):</span>
    <span class="n">datos_entrenamiento</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">datos_prueba</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">sujeto</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>  <span class="c1"># s1, s2, ..., s5</span>
        <span class="k">for</span> <span class="n">ejercicio</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>  <span class="c1"># e1, e2, ..., e8</span>
            <span class="k">for</span> <span class="n">unidad</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>  <span class="c1"># u1, u2, ..., u5</span>
                <span class="n">ruta_entrenamiento</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directorio</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;s</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;template_session.txt&quot;</span><span class="p">)</span>
                <span class="n">ruta_prueba</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directorio</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;s</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;test.txt&quot;</span><span class="p">)</span>
           
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ruta_entrenamiento</span><span class="p">):</span>
                    <span class="n">df_entrenamiento</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ruta_entrenamiento</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">clave_entrenamiento</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;es</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s2">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s2">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Clave</span>
                    <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">clave_entrenamiento</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_entrenamiento</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo de entrenamiento no encontrado en: </span><span class="si">{</span><span class="n">ruta_entrenamiento</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ruta_prueba</span><span class="p">):</span>
                    <span class="n">df_prueba</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ruta_prueba</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">clave_prueba</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ts</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s2">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s2">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Clave</span>
                    <span class="n">datos_prueba</span><span class="p">[</span><span class="n">clave_prueba</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_prueba</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo de prueba no encontrado en: </span><span class="si">{</span><span class="n">ruta_prueba</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datos_entrenamiento</span><span class="p">,</span> <span class="n">datos_prueba</span>

<span class="n">datos_entrenamiento</span><span class="p">,</span> <span class="n">datos_prueba</span> <span class="o">=</span> <span class="n">cargar_datos_entrenamiento_prueba</span><span class="p">(</span><span class="n">directorio_principal</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Se definen varias funciones esenciales para la construcción, evaluación y análisis de modelos predictivos aplicados a series de tiempo, basados en las ventanas  específicas (tau = 7, 14, 21, 28):</p>
<ol class="arabic simple">
<li><p>Divide los datos en conjuntos de características (<code class="docutils literal notranslate"><span class="pre">X</span></code>) y variables objetivo (<code class="docutils literal notranslate"><span class="pre">y</span></code>) para entrenamiento y prueba, excluyendo el índice temporal.</p></li>
<li><p>Se senera pliegues de entrenamiento, validación y prueba para cada horizonte temporal ((\tau)), asegurando que las divisiones sean coherentes con las figuras dadas.</p></li>
<li><p>Calculamos métricas para evaluar el desempeño del modelo:</p>
<ul class="simple">
<li><p><strong>MSE</strong>: Error cuadrático medio.</p></li>
<li><p><strong>RMSE</strong>: Raíz del error cuadrático medio.</p></li>
<li><p><strong>MAPE</strong>: Error porcentual absoluto medio.</p></li>
<li><p><strong>(R^2)</strong>: Coeficiente de determinación.</p></li>
<li><p><strong>Ljung-Box</strong>: Test para independencia de residuos.</p></li>
<li><p><strong>Jarque-Bera</strong>: Test para normalidad de residuos.</p></li>
</ul>
</li>
<li><p>Evalúamos los residuos del modelo mediante pruebas estadísticas, asegurando que cumplan con los supuestos de independencia (Ljung-Box) y normalidad (Jarque-Bera).</p></li>
<li><p>Implementamos y evalúamos los modelo en los diferentes pliegues y horizontes temporales ((\tau)). Los resultados de cada pliegue incluyen las métricas calculadas y se resumen en un DataFrame.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">crear_pliegues</span><span class="p">(</span><span class="n">datos_entrenamiento</span><span class="p">,</span> <span class="n">datos_prueba</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">datos_entrenamiento</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">variable</span><span class="p">,</span> <span class="s1">&#39;time index&#39;</span><span class="p">])</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
        
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">datos_prueba</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">variable</span><span class="p">,</span> <span class="s1">&#39;time index&#39;</span><span class="p">])</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">datos_prueba</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
    <span class="n">divisiones</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;X_train&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;y_train&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;X_val&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;y_val&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;X_test&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;y_test&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Construir pliegues usando datos de entrenamiento</span>
        <span class="k">for</span> <span class="n">inicio</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">tau</span><span class="p">):</span>
            <span class="n">X_train_fold</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">inicio</span><span class="p">:</span><span class="n">inicio</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tau</span><span class="p">]</span>
            <span class="n">y_train_fold</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">inicio</span><span class="p">:</span><span class="n">inicio</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tau</span><span class="p">]</span>
            
            <span class="n">X_val_fold</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">inicio</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tau</span><span class="p">:</span><span class="n">inicio</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">tau</span><span class="p">]</span>
            <span class="n">y_val_fold</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">inicio</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tau</span><span class="p">:</span><span class="n">inicio</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">tau</span><span class="p">]</span>
            
            <span class="n">X_test_fold</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="n">tau</span><span class="p">]</span>
            <span class="n">y_test_fold</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[:</span><span class="n">tau</span><span class="p">]</span>

            <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_train_fold</span><span class="p">)</span>
            <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_train_fold</span><span class="p">)</span>
            <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_val_fold</span><span class="p">)</span>
            <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_val_fold</span><span class="p">)</span>
            <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_test_fold</span><span class="p">)</span>
            <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_test_fold</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">divisiones</span>    <span class="c1"># Cargar los datos y separar X, y </span>


<span class="k">def</span> <span class="nf">calcular_metricas</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula métricas de evaluación.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">residuals</span><span class="o">=</span> <span class="n">y_true</span><span class="o">-</span><span class="n">y_pred</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">Ljung0</span><span class="p">,</span><span class="n">Jarque</span><span class="o">=</span> <span class="n">evaluar_residuos</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mape</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span><span class="n">Ljung0</span><span class="p">,</span><span class="n">Jarque</span>

<span class="k">def</span> <span class="nf">evaluar_residuos</span><span class="p">(</span><span class="n">residuos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evalúa la independencia y normalidad de los residuos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Determinar el número máximo de retardos permitido</span>
    <span class="n">max_lags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Verificar si es posible realizar el test de Ljung-Box</span>
    <span class="k">if</span> <span class="n">max_lags</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Ljung-Box test</span>
        <span class="n">ljung_box_pval</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ljung_box_pval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># No se puede calcular</span>

    <span class="c1"># Jarque-Bera test</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Jarque-Bera requiere al menos 2 residuos</span>
        <span class="n">jarque_bera_pval</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">jarque_bera_pval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># No se puede calcular</span>

    <span class="k">return</span> <span class="n">ljung_box_pval</span><span class="p">,</span> <span class="n">jarque_bera_pval</span>                      


<span class="k">def</span> <span class="nf">evaluar_modelo_knn</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
  
    <span class="n">resultados</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">])):</span>
            <span class="n">modelo</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">)</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mape</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Ljung0</span><span class="p">,</span><span class="n">Jarque</span><span class="o">=</span> <span class="n">calcular_metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">resultados</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Ventana&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span>
                <span class="s1">&#39;pliegue&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
                <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
                <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
                <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
                <span class="s1">&#39;Ljung-Box (p-value)&#39;</span><span class="p">:</span> <span class="n">Ljung0</span><span class="p">,</span>
                <span class="s1">&#39;Jarque-Bera (p-value)&#39;</span><span class="p">:</span> <span class="n">Jarque</span>         
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">)</span>           

<span class="k">def</span> <span class="nf">evaluar_modelo_lr</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
    <span class="n">resultadoslr</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Evaluación para τ = </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">])):</span>
            <span class="n">modelo</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mape</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Ljung0</span><span class="p">,</span> <span class="n">Jarque</span> <span class="o">=</span> <span class="n">calcular_metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">resultadoslr</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Ventana&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span>
                <span class="s1">&#39;pliegue&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
                <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
                <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
                <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
                <span class="s1">&#39;Ljung-Box (p-value)&#39;</span><span class="p">:</span> <span class="n">Ljung0</span><span class="p">,</span>
                <span class="s1">&#39;Jarque-Bera (p-value)&#39;</span><span class="p">:</span> <span class="n">Jarque</span>
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultadoslr</span><span class="p">)</span>         

<span class="k">def</span> <span class="nf">evaluar_modelo_ridge</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
  
    <span class="n">resultadosr</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">])):</span>
            <span class="n">modelo</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mape</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Ljung0</span><span class="p">,</span><span class="n">Jarque</span><span class="o">=</span> <span class="n">calcular_metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_test</span><span class="p">)</span>

            <span class="n">resultadosr</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Ventana&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span>
                <span class="s1">&#39;pliegue&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
                <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
                <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
                <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
                <span class="s1">&#39;Ljung-Box (p-value)&#39;</span><span class="p">:</span> <span class="n">Ljung0</span><span class="p">,</span>
                <span class="s1">&#39;Jarque-Bera (p-value)&#39;</span><span class="p">:</span> <span class="n">Jarque</span>
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultadosr</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">evaluar_modelo_lasso</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
  
    <span class="n">resultadosl</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">])):</span>
            <span class="c1"># Ajustar modelo k-NN</span>
            <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;log-uniform&#39;</span><span class="p">)}</span>
            <span class="n">modelo</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span><span class="n">Lasso</span><span class="p">(),</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
           
            <span class="n">y_pred</span><span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            
            <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mape</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Ljung0</span><span class="p">,</span><span class="n">Jarque</span><span class="o">=</span> <span class="n">calcular_metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

            <span class="n">resultadosl</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Ventana&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span>
                <span class="s1">&#39;pliegue&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
                <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
                <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
                <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
                <span class="s1">&#39;Ljung-Box (p-value)&#39;</span><span class="p">:</span> <span class="n">Ljung0</span><span class="p">,</span>
                <span class="s1">&#39;Jarque-Bera (p-value)&#39;</span><span class="p">:</span> <span class="n">Jarque</span>
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultadosl</span><span class="p">)</span> 
    
<span class="k">def</span> <span class="nf">evaluar_modelo_random</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
  
    <span class="n">resultadosr</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluando para: </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">])):</span>
            <span class="c1"># Ajustar modelo k-NN</span>
            <span class="n">modelo</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
           
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            
            <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mape</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Ljung0</span><span class="p">,</span><span class="n">Jarque</span><span class="o">=</span> <span class="n">calcular_metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

            <span class="n">resultadosr</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Ventana&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span>
                <span class="s1">&#39;pliegue&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
                <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
                <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
                <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
                <span class="s1">&#39;Ljung-Box (p-value)&#39;</span><span class="p">:</span> <span class="n">Ljung0</span><span class="p">,</span>
                <span class="s1">&#39;Jarque-Bera (p-value)&#39;</span><span class="p">:</span> <span class="n">Jarque</span>
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultadosr</span><span class="p">)</span>     
<span class="k">def</span> <span class="nf">evaluar_modelo_xg</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
  
    <span class="n">resultadosxg</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Evaluación para τ = </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">])):</span>
            <span class="c1"># Ajustar modelo k-NN</span>
            <span class="n">modelo</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
           
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            
            <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mape</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Ljung0</span><span class="p">,</span><span class="n">Jarque</span><span class="o">=</span> <span class="n">calcular_metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

            <span class="n">resultadosxg</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Ventana&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span>
                <span class="s1">&#39;pliegue&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
                <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
                <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
                <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
                <span class="s1">&#39;Ljung-Box (p-value)&#39;</span><span class="p">:</span> <span class="n">Ljung0</span><span class="p">,</span>
                <span class="s1">&#39;Jarque-Bera (p-value)&#39;</span><span class="p">:</span> <span class="n">Jarque</span>
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultadosxg</span><span class="p">)</span> 
            
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;epsilon&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
    <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">]</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">evaluar_modelo_svr</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
  
    <span class="n">resultadossvr</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Evaluación para τ = </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">])):</span>
        
            <span class="n">modelo</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVR</span><span class="p">(),</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
            <span class="n">modelo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
           
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            
            <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mape</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Ljung0</span><span class="p">,</span><span class="n">Jarque</span><span class="o">=</span> <span class="n">calcular_metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

            <span class="n">resultadossvr</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Ventana&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span>
                <span class="s1">&#39;pliegue&#39;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="n">mse</span><span class="p">,</span>
                <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
                <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span>
                <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
                <span class="s1">&#39;Ljung-Box (p-value)&#39;</span><span class="p">:</span> <span class="n">Ljung0</span><span class="p">,</span>
                <span class="s1">&#39;Jarque-Bera (p-value)&#39;</span><span class="p">:</span> <span class="n">Jarque</span>
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultadossvr</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<section id="visualizamos-los-pliegues">
<h2>Visualizamos los pliegues<a class="headerlink" href="#visualizamos-los-pliegues" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">visualizar_pliegues_completos</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Visualización para τ = </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pliegues disponibles: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">],</span> 
                <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;X_test&#39;</span><span class="p">],</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">])):</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pliegue </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> para τ = </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_train: </span><span class="si">{</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, y_train: </span><span class="si">{</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_val: </span><span class="si">{</span><span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, y_val: </span><span class="si">{</span><span class="n">y_val</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_test: </span><span class="si">{</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, y_test: </span><span class="si">{</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Se implementaron dos funciones clave para visualizar cómo se organizan los pliegues generados en un conjunto de datos dividido en entrenamiento, validación y prueba, tomando como ejemplo los valores de la ventana ((7, 14, 21, 28)) y los datos de entrenamiento y prueba (<code class="docutils literal notranslate"><span class="pre">datos_entrenamiento['es1e1u1']</span></code> y <code class="docutils literal notranslate"><span class="pre">datos_prueba['ts1e1u1']</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>

<span class="n">divisiones</span> <span class="o">=</span> <span class="n">crear_pliegues</span><span class="p">(</span><span class="n">datos_entrenamiento</span><span class="p">[</span><span class="s1">&#39;es1e1u1&#39;</span><span class="p">],</span> <span class="n">datos_prueba</span><span class="p">[</span><span class="s1">&#39;ts1e1u1&#39;</span><span class="p">],</span> <span class="n">tau_list</span><span class="p">)</span>

<span class="n">visualizar_pliegues_completos</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Por otro lado, la función <code class="docutils literal notranslate"><span class="pre">graficar_pliegues</span></code> genera una representación visual de los pliegues, utilizando colores distintos para diferenciar entrenamiento (azul), validación (naranja) y prueba (verde). Para cada valor de ventana, se crea un subgráfico que muestra cómo los conjuntos están escalonados en el tiempo, con un límite de 20 pliegues para mantener la claridad visual. Estas gráficas ofrecen una representación intuitiva de cómo se estructuran los conjuntos de datos para un ejemplo específico, facilitando la comprensión del proceso de validación cruzada temporal y sirviendo como una herramienta de verificación antes de aplicar los pliegues a modelos predictivos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">graficar_pliegues</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">):</span>
    <span class="n">colores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>  
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tau_list</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tau_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
 
        <span class="n">num_pliegues</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_pliegues</span><span class="p">):</span>
            <span class="n">inicio_train</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">fin_train</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tau</span>
            <span class="n">inicio_val</span> <span class="o">=</span> <span class="n">fin_train</span>
            <span class="n">fin_val</span> <span class="o">=</span> <span class="n">inicio_val</span> <span class="o">+</span> <span class="n">tau</span>
    
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">inicio_train</span><span class="p">,</span> <span class="n">fin_train</span><span class="p">),</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">fin_train</span> <span class="o">-</span> <span class="n">inicio_train</span><span class="p">),</span> 
                     <span class="n">color</span><span class="o">=</span><span class="n">colores</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">inicio_val</span><span class="p">,</span> <span class="n">fin_val</span><span class="p">),</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">fin_val</span> <span class="o">-</span> <span class="n">inicio_val</span><span class="p">),</span> 
                     <span class="n">color</span><span class="o">=</span><span class="n">colores</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="p">),</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">tau</span><span class="p">,</span> 
                     <span class="n">color</span><span class="o">=</span><span class="n">colores</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Visualización de pliegues para τ = </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Índice de tiempo&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Pliegues&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Llamar a la función para visualizar los pliegues</span>
<span class="n">graficar_pliegues</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/43e9f4a5c33bbb74ad02f8d981deb51cd654b0191204e03c8425b6b97c3437e8.png" src="_images/43e9f4a5c33bbb74ad02f8d981deb51cd654b0191204e03c8425b6b97c3437e8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">graficar_diagnostico_residuos</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">nombre_modelo</span><span class="p">):</span>
    <span class="n">residuos</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">residuos</span><span class="p">)]</span>  
    <span class="n">residuos</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">residuos</span><span class="p">)]</span>  
    <span class="n">residuos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> 
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No hay suficientes datos para graficar ACF o QQPlot.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Residuos&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Serie de Residuos - </span><span class="si">{</span><span class="n">nombre_modelo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="c1"># QQPlot de los residuos</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QQPlot de Residuos - </span><span class="si">{</span><span class="n">nombre_modelo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># ACF de los residuos</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">max_lags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Ajustar el número máximo de lags</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ACF de Residuos - </span><span class="si">{</span><span class="n">nombre_modelo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>La función graficar_diagnostico_residuos está diseñada para analizar y diagnosticar los residuos de un modelo predictivo mediante tres visualizaciones principales: una serie de residuos, un gráfico QQPlot, y la función de autocorrelación (ACF). Primero, limpia los datos eliminando valores no válidos (NaN o infinitos) y asegura que haya suficientes puntos para el análisis. La serie de residuos permite identificar patrones o tendencias no modeladas, mientras que el QQPlot compara la distribución de los residuos con una normal teórica para evaluar su normalidad. Finalmente, el gráfico ACF verifica la independencia de los residuos al analizar la autocorrelación con diferentes retardos. Estos gráficos proporcionan información crítica para validar los supuestos estadísticos del modelo, ayudando a identificar posibles ajustes o mejoras necesarias en el proceso de modelado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">obtener_mejores_resultados</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="n">criterio</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">criterio</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">criterio</span> <span class="o">==</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span>  
            <span class="n">mejor_modelo</span> <span class="o">=</span> <span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">resultados</span><span class="p">[</span><span class="n">criterio</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>  
            <span class="n">mejor_modelo</span> <span class="o">=</span> <span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">resultados</span><span class="p">[</span><span class="n">criterio</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Criterio no reconocido: </span><span class="si">{</span><span class="n">criterio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">mejor_modelo</span>  
</pre></div>
</div>
</div>
</div>
<p>Se evaluaron todos los modelos predictivos para las variables respuesta ( y ) de un único sujeto, considerando todas las combinaciones posibles de unidades ( u1, u2, …, u5 ) y ejercicios ( e1, e2, …, e8 ). Para cada variable ( acc_x, acc_y, acc_z, etc. ), se seleccionó el modelo con el mejor desempeño utilizando métricas como el coeficiente de determinación ( R^2 ) o el error cuadrático medio ( MSE ), asegurando así el mejor ajuste del modelo. La función <strong><code class="docutils literal notranslate"><span class="pre">obtener_mejores_resultados</span></code></strong> se empleó para automatizar este proceso, seleccionando el modelo con el ( R^2 ) más alto o, en caso de otras métricas, con el valor más bajo, de manera uniforme y sistemática.</p>
<p>Los resultados se organizaron en tablas separadas por modelo, detallando las métricas de desempeño para cada variable respuesta junto con la combinación de unidad y ejercicio correspondiente. Este enfoque garantiza un análisis completo y estructurado, optimizando el rendimiento del modelo para cada variable y proporcionando una comparación directa basada en criterios cuantitativos y consistentes.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="implementacion">
<h1>Implementación<a class="headerlink" href="#implementacion" title="Link to this heading">#</a></h1>
<section id="knn">
<h2>KNN<a class="headerlink" href="#knn" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;acc_x&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_y&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_z&#39;</span><span class="p">,</span> <span class="s1">&#39;gyr_x&#39;</span><span class="p">,</span> <span class="s1">&#39;gyr_y&#39;</span><span class="p">,</span> <span class="s1">&#39;gyr_z&#39;</span><span class="p">,</span> <span class="s1">&#39;mag_x&#39;</span><span class="p">,</span> <span class="s1">&#39;mag_y&#39;</span><span class="p">,</span> <span class="s1">&#39;mag_z&#39;</span><span class="p">]</span>


<span class="n">sujeto</span> <span class="o">=</span> <span class="mi">1</span>  
<span class="n">ejercicios</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>  
<span class="n">unidades</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>  

<span class="c1"># Lista para almacenar resultados de todas las combinaciones</span>
<span class="n">resultados_completos</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="k">for</span> <span class="n">ejercicio</span> <span class="ow">in</span> <span class="n">ejercicios</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">unidad</span> <span class="ow">in</span> <span class="n">unidades</span><span class="p">:</span>
        <span class="n">clave_entrenamiento</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;es</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">clave_prueba</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ts</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
        
        <span class="c1"># Verificar si las claves están en los datos</span>
        <span class="k">if</span> <span class="n">clave_entrenamiento</span> <span class="ow">in</span> <span class="n">datos_entrenamiento</span> <span class="ow">and</span> <span class="n">clave_prueba</span> <span class="ow">in</span> <span class="n">datos_prueba</span><span class="p">:</span>
            <span class="n">divisiones</span> <span class="o">=</span> <span class="n">crear_pliegues</span><span class="p">(</span>
                <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">clave_entrenamiento</span><span class="p">],</span>
                <span class="n">datos_prueba</span><span class="p">[</span><span class="n">clave_prueba</span><span class="p">],</span>
                <span class="n">variables</span><span class="p">,</span>
                <span class="n">tau_list</span>
            <span class="p">)</span>
            <span class="c1"># Evaluar y seleccionar el mejor modelo para cada variable</span>
            <span class="n">resultados</span> <span class="o">=</span> <span class="n">evaluar_modelo_knn</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">mejor_resultado</span> <span class="o">=</span> <span class="n">obtener_mejores_resultados</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="n">criterio</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">)</span>
            <span class="n">resultados_completos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mejor_resultado</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Claves no encontradas: </span><span class="si">{</span><span class="n">clave_entrenamiento</span><span class="si">}</span><span class="s2"> o </span><span class="si">{</span><span class="n">clave_prueba</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="los-mejores-modelos">
<h3>Los mejores modelos<a class="headerlink" href="#los-mejores-modelos" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados_completos</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ventana</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>R2</th>
      <th>Ljung-Box (p-value)</th>
      <th>Jarque-Bera (p-value)</th>
      <th>variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>100</th>
      <td>7.0</td>
      <td>6.854017e-05</td>
      <td>0.008279</td>
      <td>0.057547</td>
      <td>0.843474</td>
      <td>0.273886</td>
      <td>0.534349</td>
      <td>acc_x</td>
    </tr>
    <tr>
      <th>21</th>
      <td>7.0</td>
      <td>1.514589e-04</td>
      <td>0.012307</td>
      <td>0.655401</td>
      <td>0.796674</td>
      <td>0.107306</td>
      <td>0.828277</td>
      <td>acc_y</td>
    </tr>
    <tr>
      <th>18</th>
      <td>7.0</td>
      <td>1.072232e-04</td>
      <td>0.010355</td>
      <td>1.370848</td>
      <td>0.858014</td>
      <td>0.358154</td>
      <td>0.947569</td>
      <td>acc_z</td>
    </tr>
    <tr>
      <th>563</th>
      <td>7.0</td>
      <td>3.618022e-05</td>
      <td>0.006015</td>
      <td>118.785745</td>
      <td>0.649744</td>
      <td>0.371555</td>
      <td>0.796987</td>
      <td>gyr_x</td>
    </tr>
    <tr>
      <th>1592</th>
      <td>7.0</td>
      <td>7.828169e-06</td>
      <td>0.002798</td>
      <td>48.576937</td>
      <td>0.803702</td>
      <td>0.710231</td>
      <td>0.675659</td>
      <td>gyr_y</td>
    </tr>
    <tr>
      <th>524</th>
      <td>7.0</td>
      <td>3.815489e-05</td>
      <td>0.006177</td>
      <td>153.141813</td>
      <td>0.693593</td>
      <td>0.787553</td>
      <td>0.595898</td>
      <td>gyr_z</td>
    </tr>
    <tr>
      <th>1977</th>
      <td>7.0</td>
      <td>5.148097e-08</td>
      <td>0.000227</td>
      <td>0.035027</td>
      <td>0.680844</td>
      <td>0.753281</td>
      <td>0.695350</td>
      <td>mag_x</td>
    </tr>
    <tr>
      <th>545</th>
      <td>7.0</td>
      <td>3.584464e-07</td>
      <td>0.000599</td>
      <td>0.103253</td>
      <td>0.691997</td>
      <td>0.435722</td>
      <td>0.841069</td>
      <td>mag_y</td>
    </tr>
    <tr>
      <th>1411</th>
      <td>7.0</td>
      <td>5.756699e-08</td>
      <td>0.000240</td>
      <td>0.269674</td>
      <td>0.790501</td>
      <td>0.175797</td>
      <td>0.962816</td>
      <td>mag_z</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Los resultados muestran un desempeño aceptable en términos de las métricas evaluadas, con valores de ( R^2 ) moderados, indicando que los modelos explican entre el 65% y el 85% de la variabilidad de las variables respuesta, dependiendo de la variable analizada. Las métricas de error absoluto (( MSE ), ( RMSE )) son bajas en general, reflejando una precisión adecuada, aunque variables como <code class="docutils literal notranslate"><span class="pre">gyr_x</span></code>, <code class="docutils literal notranslate"><span class="pre">gyr_z</span></code> y <code class="docutils literal notranslate"><span class="pre">gyr_y</span></code> presentan valores de ( MAPE ) elevados, sugiriendo dificultades del modelo para predecir valores extremos o cambios abruptos en estas variables.</p>
</section>
<section id="graficas-de-los-residuos">
<h3>Graficas de los residuos<a class="headerlink" href="#graficas-de-los-residuos" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">resultados_completos</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
    <span class="n">mejor_tau</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Ventana&#39;</span><span class="p">]</span>  
    <span class="n">mejor_pliegue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pliegue&#39;</span><span class="p">])</span>  

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generando gráfico de residuos para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">, τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">, pliegue=</span><span class="si">{</span><span class="n">mejor_pliegue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">X_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">modelo_best</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> 
    <span class="n">modelo_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">,</span> <span class="n">y_train_best</span><span class="p">)</span>

    <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_pred_best</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)</span>

    <span class="n">graficar_diagnostico_residuos</span><span class="p">(</span>
        <span class="n">residuos_best</span><span class="p">,</span> 
        <span class="n">nombre_modelo</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mejor Modelo para </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> (τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_x, τ=7.0, pliegue=101
</pre></div>
</div>
<img alt="_images/f26e4fd150d539963cb680dd5b65471864017fa7689bad8f8c97b0200ede7dc5.png" src="_images/f26e4fd150d539963cb680dd5b65471864017fa7689bad8f8c97b0200ede7dc5.png" />
<img alt="_images/006804daa9f913a8cdceb64d3a196350d4a9127d375a6b7682728ad0c6e3c014.png" src="_images/006804daa9f913a8cdceb64d3a196350d4a9127d375a6b7682728ad0c6e3c014.png" />
<img alt="_images/1cde9c79cad3a3ef60fac1248aab558c6e0fe542fe1308cbf91d0178086f970b.png" src="_images/1cde9c79cad3a3ef60fac1248aab558c6e0fe542fe1308cbf91d0178086f970b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_y, τ=7.0, pliegue=22
</pre></div>
</div>
<img alt="_images/dc78298fdfba73011e3ff6d43eb54f07b278e371f0473a167386ce2424d0ac50.png" src="_images/dc78298fdfba73011e3ff6d43eb54f07b278e371f0473a167386ce2424d0ac50.png" />
<img alt="_images/9559c45aa0b12ac0556881cb9f064edbd79492f311e5c0e94f647757032cec1f.png" src="_images/9559c45aa0b12ac0556881cb9f064edbd79492f311e5c0e94f647757032cec1f.png" />
<img alt="_images/ed1d16180fe1842fa35ac69078fd2a0e948897c490e79b2d0a6cc4aa79d94e53.png" src="_images/ed1d16180fe1842fa35ac69078fd2a0e948897c490e79b2d0a6cc4aa79d94e53.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_z, τ=7.0, pliegue=19
</pre></div>
</div>
<img alt="_images/971a9c711b5fdd9cb9187505eba3ca49b7979080537683a437ba96e59ace6a2c.png" src="_images/971a9c711b5fdd9cb9187505eba3ca49b7979080537683a437ba96e59ace6a2c.png" />
<img alt="_images/4456c269b4b086f8b1daadbefbe46d307ca3fe8a9de2d23f5b271b777dc0c139.png" src="_images/4456c269b4b086f8b1daadbefbe46d307ca3fe8a9de2d23f5b271b777dc0c139.png" />
<img alt="_images/39488bc7407d9c027f706f1ae31c72c406be21d68abeeaa99c0c4746c4cd0fa7.png" src="_images/39488bc7407d9c027f706f1ae31c72c406be21d68abeeaa99c0c4746c4cd0fa7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_x, τ=7.0, pliegue=564
</pre></div>
</div>
<img alt="_images/141efee75eefaf1dbc02118dcb0e8dc7b84489997b58eba8cc4a9c4b0ec69740.png" src="_images/141efee75eefaf1dbc02118dcb0e8dc7b84489997b58eba8cc4a9c4b0ec69740.png" />
<img alt="_images/a82dc6d88aa10fa4b37b831617182dc66ee586323bcf5db7b80753d9f3bb63a7.png" src="_images/a82dc6d88aa10fa4b37b831617182dc66ee586323bcf5db7b80753d9f3bb63a7.png" />
<img alt="_images/63f15253d0c173a907fb148f3b734fad5cd0c14654a95a9d7a217bbf5d058026.png" src="_images/63f15253d0c173a907fb148f3b734fad5cd0c14654a95a9d7a217bbf5d058026.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_y, τ=7.0, pliegue=1593
</pre></div>
</div>
<img alt="_images/45dd20099f806502cddc09ef2f05ed16b217fda071988f3454f9a832c7bd9cfc.png" src="_images/45dd20099f806502cddc09ef2f05ed16b217fda071988f3454f9a832c7bd9cfc.png" />
<img alt="_images/93fa314ade9299bad30a704c1eaf7dd604619e8dc219bce859bf624d8a1098ef.png" src="_images/93fa314ade9299bad30a704c1eaf7dd604619e8dc219bce859bf624d8a1098ef.png" />
<img alt="_images/3c4ff571af8a6df742e6978d3808eaf7bf4c3b7764996391649330840fb53c0a.png" src="_images/3c4ff571af8a6df742e6978d3808eaf7bf4c3b7764996391649330840fb53c0a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_z, τ=7.0, pliegue=525
</pre></div>
</div>
<img alt="_images/3e037528de422090cb8226b34d0acc65c7f20fb487016bcad7be86bd906f129c.png" src="_images/3e037528de422090cb8226b34d0acc65c7f20fb487016bcad7be86bd906f129c.png" />
<img alt="_images/c55658f09726cc59f8cd7f3afb8b8ffce5d2fad777ae9d556342ed37388bee50.png" src="_images/c55658f09726cc59f8cd7f3afb8b8ffce5d2fad777ae9d556342ed37388bee50.png" />
<img alt="_images/d787a6eb6e831465f23fbc6c9e9bd08f7e1eddac052c57a8605519241761b524.png" src="_images/d787a6eb6e831465f23fbc6c9e9bd08f7e1eddac052c57a8605519241761b524.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_x, τ=7.0, pliegue=1978
</pre></div>
</div>
<img alt="_images/625a0ed978c93763750128d288a8f81b48cdfa94d8ea189a5ad3465c541ba32a.png" src="_images/625a0ed978c93763750128d288a8f81b48cdfa94d8ea189a5ad3465c541ba32a.png" />
<img alt="_images/e9289578df928072d83a9fd77d49d5a518462efcea78e3951b64b8f80db8dbf5.png" src="_images/e9289578df928072d83a9fd77d49d5a518462efcea78e3951b64b8f80db8dbf5.png" />
<img alt="_images/3826131163a4473579fc6dc0e205e319b8bbac95464b0895add9612c5db30273.png" src="_images/3826131163a4473579fc6dc0e205e319b8bbac95464b0895add9612c5db30273.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_y, τ=7.0, pliegue=546
</pre></div>
</div>
<img alt="_images/5987ddec62435a5ce0a95cfd4c5437353d2ae4a534b613d6b8125a66e149beb7.png" src="_images/5987ddec62435a5ce0a95cfd4c5437353d2ae4a534b613d6b8125a66e149beb7.png" />
<img alt="_images/a0ce0a11637b5513a1e45b7192e94eac5aec5e649478803f77187d454d5c2a9d.png" src="_images/a0ce0a11637b5513a1e45b7192e94eac5aec5e649478803f77187d454d5c2a9d.png" />
<img alt="_images/b6a5ca72e7c257dc33cb778a4081d8e1722ee48e86b4cb358253893a4e5b9350.png" src="_images/b6a5ca72e7c257dc33cb778a4081d8e1722ee48e86b4cb358253893a4e5b9350.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_z, τ=7.0, pliegue=1412
</pre></div>
</div>
<img alt="_images/7a08555d03e45a4bf6ff1536af870ce5fa3466c9b5581afdb3fd782dc1334945.png" src="_images/7a08555d03e45a4bf6ff1536af870ce5fa3466c9b5581afdb3fd782dc1334945.png" />
<img alt="_images/043e4e6af03d5659d8b0613913d7dc3d121fc1254eaacff84e557df1baf8a921.png" src="_images/043e4e6af03d5659d8b0613913d7dc3d121fc1254eaacff84e557df1baf8a921.png" />
<img alt="_images/712f0a19a30bcdf85d84c8bdb773b4f2ea243e72af15754040c75547b3d4b725.png" src="_images/712f0a19a30bcdf85d84c8bdb773b4f2ea243e72af15754040c75547b3d4b725.png" />
</div>
</div>
<p>Las gráficas de los residuos muestran un análisis detallado del desempeño de los modelos ajustados para las variables <code class="docutils literal notranslate"><span class="pre">acc_x</span></code>, <code class="docutils literal notranslate"><span class="pre">acc_y</span></code> y <code class="docutils literal notranslate"><span class="pre">acc_z</span></code>. En las series de residuos, los valores fluctúan alrededor de cero, lo cual indica un comportamiento simétrico y ausencia de patrones significativos, aunque con variaciones leves en su magnitud. Los gráficos QQ-plot confirman que los residuos siguen en gran medida una distribución normal, con ligeras desviaciones en los extremos. Finalmente, las funciones de autocorrelación (ACF) revelan que los residuos son mayormente independientes, con valores dentro de los intervalos de confianza. En general, los modelos muestran un buen ajuste, aunque podrían beneficiarse de ajustes adicionales para mejorar la normalidad y la independencia en ciertas variables. Estas observaciones sugieren que los modelos no cumplen completamente con los supuestos de normalidad e independencia.</p>
</section>
<section id="boxplot">
<h3>Boxplot<a class="headerlink" href="#boxplot" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Crear un DataFrame para almacenar los errores</span>
<span class="n">errores_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Iterar sobre las variables y calcular errores</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando errores para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">X_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">)</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_best</span><span class="p">)</span>

    <span class="c1"># Calcular errores absolutos</span>
    <span class="n">errores_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_train_best</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="p">)</span>
    <span class="n">errores_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_val_pred</span><span class="p">)</span>
    <span class="n">errores_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_test_best</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="p">)</span>

    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_train</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_val</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_test</span>
    <span class="p">])</span>

<span class="n">df_errores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errores_data</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Set&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_errores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribución de Errores por Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error Absoluto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando errores para la variable: acc_x
Procesando errores para la variable: acc_y
Procesando errores para la variable: acc_z
Procesando errores para la variable: gyr_x
Procesando errores para la variable: gyr_y
Procesando errores para la variable: gyr_z
Procesando errores para la variable: mag_x
Procesando errores para la variable: mag_y
Procesando errores para la variable: mag_z
</pre></div>
</div>
<img alt="_images/1576db04b5e76111085a2c18908082b06f74c0cd686e5306c2c89bfd29fca788.png" src="_images/1576db04b5e76111085a2c18908082b06f74c0cd686e5306c2c89bfd29fca788.png" />
</div>
</div>
<p>El boxplot muestra la distribución de errores absolutos en los conjuntos de entrenamiento, validación y prueba. Las medianas son cercanas, lo que indica consistencia en el desempeño del modelo entre los conjuntos, aunque el conjunto de validación presenta una mayor dispersión, evidenciada por la amplitud del rango intercuartílico y la presencia de valores más extremos en comparación con los otros conjuntos. Esto sugiere que el modelo mantiene un desempeño estable, aunque podría estar enfrentando ligeros desafíos para generalizar en los datos de validación.</p>
</section>
</section>
<section id="regresion-lineal">
<h2>Regresion Lineal<a class="headerlink" href="#regresion-lineal" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_completos</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="k">for</span> <span class="n">ejercicio</span> <span class="ow">in</span> <span class="n">ejercicios</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">unidad</span> <span class="ow">in</span> <span class="n">unidades</span><span class="p">:</span>
        <span class="n">clave_entrenamiento</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;es</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">clave_prueba</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ts</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
   
        <span class="k">if</span> <span class="n">clave_entrenamiento</span> <span class="ow">in</span> <span class="n">datos_entrenamiento</span> <span class="ow">and</span> <span class="n">clave_prueba</span> <span class="ow">in</span> <span class="n">datos_prueba</span><span class="p">:</span>
            <span class="n">divisiones</span> <span class="o">=</span> <span class="n">crear_pliegues</span><span class="p">(</span>
                <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">clave_entrenamiento</span><span class="p">],</span>
                <span class="n">datos_prueba</span><span class="p">[</span><span class="n">clave_prueba</span><span class="p">],</span>
                <span class="n">variables</span><span class="p">,</span>
                <span class="n">tau_list</span>
            <span class="p">)</span>
            <span class="n">resultados</span> <span class="o">=</span> <span class="n">evaluar_modelo_lr</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">)</span>
            <span class="n">mejor_resultado</span> <span class="o">=</span> <span class="n">obtener_mejores_resultados</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="n">criterio</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">)</span>
            <span class="n">resultados_completos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mejor_resultado</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Claves no encontradas: </span><span class="si">{</span><span class="n">clave_entrenamiento</span><span class="si">}</span><span class="s2"> o </span><span class="si">{</span><span class="n">clave_prueba</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28
</pre></div>
</div>
</div>
</div>
<section id="mejores-modelos">
<h3>Mejores Modelos<a class="headerlink" href="#mejores-modelos" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados_completos</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ventana</th>
      <th>pliegue</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>R2</th>
      <th>Ljung-Box (p-value)</th>
      <th>Jarque-Bera (p-value)</th>
      <th>variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>487</th>
      <td>7.0</td>
      <td>488.0</td>
      <td>1.330995e-04</td>
      <td>0.011537</td>
      <td>0.093420</td>
      <td>0.791331</td>
      <td>0.210613</td>
      <td>0.963471</td>
      <td>acc_x</td>
    </tr>
    <tr>
      <th>541</th>
      <td>7.0</td>
      <td>542.0</td>
      <td>9.960658e-04</td>
      <td>0.031561</td>
      <td>1.633014</td>
      <td>0.834464</td>
      <td>0.189027</td>
      <td>0.749329</td>
      <td>acc_y</td>
    </tr>
    <tr>
      <th>1378</th>
      <td>7.0</td>
      <td>1379.0</td>
      <td>4.794075e-04</td>
      <td>0.021895</td>
      <td>6.253765</td>
      <td>0.801632</td>
      <td>0.031467</td>
      <td>0.665750</td>
      <td>acc_z</td>
    </tr>
    <tr>
      <th>2138</th>
      <td>7.0</td>
      <td>2139.0</td>
      <td>7.485015e-06</td>
      <td>0.002736</td>
      <td>150.096968</td>
      <td>0.824004</td>
      <td>0.474754</td>
      <td>0.638568</td>
      <td>gyr_x</td>
    </tr>
    <tr>
      <th>1430</th>
      <td>7.0</td>
      <td>1431.0</td>
      <td>4.437604e-06</td>
      <td>0.002107</td>
      <td>43.965489</td>
      <td>0.784630</td>
      <td>0.283151</td>
      <td>0.689422</td>
      <td>gyr_y</td>
    </tr>
    <tr>
      <th>491</th>
      <td>7.0</td>
      <td>492.0</td>
      <td>2.038298e-05</td>
      <td>0.004515</td>
      <td>41.303151</td>
      <td>0.881099</td>
      <td>0.710278</td>
      <td>0.856885</td>
      <td>gyr_z</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>7.0</td>
      <td>1215.0</td>
      <td>2.625645e-07</td>
      <td>0.000512</td>
      <td>0.075749</td>
      <td>0.676455</td>
      <td>0.947748</td>
      <td>0.095284</td>
      <td>mag_x</td>
    </tr>
    <tr>
      <th>233</th>
      <td>7.0</td>
      <td>234.0</td>
      <td>3.346895e-08</td>
      <td>0.000183</td>
      <td>0.029638</td>
      <td>0.933318</td>
      <td>0.328730</td>
      <td>0.621725</td>
      <td>mag_y</td>
    </tr>
    <tr>
      <th>5199</th>
      <td>21.0</td>
      <td>889.0</td>
      <td>1.263145e-06</td>
      <td>0.001124</td>
      <td>1.197691</td>
      <td>0.868569</td>
      <td>0.650509</td>
      <td>0.955475</td>
      <td>mag_z</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Los resultados de la regresión lineal muestran un desempeño moderado en términos de ( R^2 ), con valores que oscilan entre 0.67 y 0.93, dependiendo de la variable analizada. Esto indica que el modelo es capaz de explicar entre el 67% y el 93% de la variabilidad de las variables respuesta. Las métricas de error cuadrático medio ( MSE ) y su raíz ( RMSE ) son bajas para la mayoría de las variables, lo que refleja una buena precisión general del modelo.</p>
<p>En términos de la normalidad y la independencia de los residuos, las pruebas de Jarque-Bera y Ljung-Box muestran p-valores que en su mayoría son aceptables, indicando residuos independientes y generalmente normales. Sin embargo, en ciertas variables como <code class="docutils literal notranslate"><span class="pre">acc_z</span></code> y <code class="docutils literal notranslate"><span class="pre">gyr_x</span></code>, los p-valores más bajos podrían sugerir ligeras desviaciones de estos supuestos.</p>
</section>
<section id="residuos">
<h3>Residuos<a class="headerlink" href="#residuos" title="Link to this heading">#</a></h3>
<p>En este fragmento de código, se genera un análisis detallado de los residuos para cada variable y configuración óptima (τ y pliegue) identificada previamente en los resultados del modelo. Para cada combinación óptima, se seleccionan los conjuntos de entrenamiento, validación y prueba correspondientes. Luego, se ajusta un modelo de regresión lineal utilizando los datos de entrenamiento y se realiza la predicción sobre los datos de validación. Los residuos (diferencia entre valores reales y predichos) se calculan y se transforman en un arreglo numérico. Finalmente, se genera un gráfico diagnóstico de los residuos, que permite analizar su comportamiento y verificar si cumplen con los supuestos de independencia y normalidad, ofreciendo una visión clara del desempeño del modelo bajo las condiciones óptimas seleccionadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">resultados_completos</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
    <span class="n">mejor_tau</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Ventana&#39;</span><span class="p">]</span>  
    <span class="n">mejor_pliegue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pliegue&#39;</span><span class="p">])</span> 

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generando gráfico de residuos para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">, τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">, pliegue=</span><span class="si">{</span><span class="n">mejor_pliegue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">X_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">modelo_best</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span> 
    <span class="n">modelo_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">,</span> <span class="n">y_train_best</span><span class="p">)</span>

    <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_pred_best</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)</span>

    <span class="c1"># Generar el gráfico para los residuos</span>
    <span class="n">graficar_diagnostico_residuos</span><span class="p">(</span>
        <span class="n">residuos_best</span><span class="p">,</span> 
        <span class="n">nombre_modelo</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mejor Modelo para </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> (τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_x, τ=7.0, pliegue=488
</pre></div>
</div>
<img alt="_images/1d4930432cd89027d19aaad061c1721360efec7ae4a9932719da9e23dcc5da52.png" src="_images/1d4930432cd89027d19aaad061c1721360efec7ae4a9932719da9e23dcc5da52.png" />
<img alt="_images/8c08bb5ab6264e9c4f3af3e7b84f158e3d3ce498939fc3cb2d29b9bc53e6847d.png" src="_images/8c08bb5ab6264e9c4f3af3e7b84f158e3d3ce498939fc3cb2d29b9bc53e6847d.png" />
<img alt="_images/18b2f837325e686923a32eff2537c12f1d43b0d3bf815c4875ee88023de3ce51.png" src="_images/18b2f837325e686923a32eff2537c12f1d43b0d3bf815c4875ee88023de3ce51.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_y, τ=7.0, pliegue=542
</pre></div>
</div>
<img alt="_images/65ac57b895f3f707c57a2f98dc57df87ace86c2bd59cddf65b825265a6f5a70d.png" src="_images/65ac57b895f3f707c57a2f98dc57df87ace86c2bd59cddf65b825265a6f5a70d.png" />
<img alt="_images/6f0683449cb3ee6e26e92deb509729011c2b5f6b9432043835257689cbaef1f1.png" src="_images/6f0683449cb3ee6e26e92deb509729011c2b5f6b9432043835257689cbaef1f1.png" />
<img alt="_images/d674b6c0d12a781d9cd8e12c6fccd75e204dd8e846e901201a33e34de95b36ba.png" src="_images/d674b6c0d12a781d9cd8e12c6fccd75e204dd8e846e901201a33e34de95b36ba.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_z, τ=7.0, pliegue=1379
</pre></div>
</div>
<img alt="_images/8a2ac3d44749222f498b557869178467322a8c836eb528cf72c461e07827d1dd.png" src="_images/8a2ac3d44749222f498b557869178467322a8c836eb528cf72c461e07827d1dd.png" />
<img alt="_images/b06f737e8381249e5b2ba1170ff07a207681b71aee736cdbd0eb09094e703845.png" src="_images/b06f737e8381249e5b2ba1170ff07a207681b71aee736cdbd0eb09094e703845.png" />
<img alt="_images/09774708e5ad5d91d011862669898afef89d84f5af2c90844df44dff9fa61b9b.png" src="_images/09774708e5ad5d91d011862669898afef89d84f5af2c90844df44dff9fa61b9b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_x, τ=7.0, pliegue=2139
</pre></div>
</div>
<img alt="_images/15edf6ec5b9f025ebdf9c10b6d10a26205f183e8db0c8ea3fd2ecd59ec65ee09.png" src="_images/15edf6ec5b9f025ebdf9c10b6d10a26205f183e8db0c8ea3fd2ecd59ec65ee09.png" />
<img alt="_images/e0d4363f6b16706c823423e6590ab7094a932042569714bb8bd9a882b3ef5f7b.png" src="_images/e0d4363f6b16706c823423e6590ab7094a932042569714bb8bd9a882b3ef5f7b.png" />
<img alt="_images/5361d82d292110a5328d84155ddac2c7d7889165d5d5c82c73bc9d9da4f82d2b.png" src="_images/5361d82d292110a5328d84155ddac2c7d7889165d5d5c82c73bc9d9da4f82d2b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_y, τ=7.0, pliegue=1431
</pre></div>
</div>
<img alt="_images/ade7b1b7c1947493db3ddc15c6be9466bfcaa97563515c43a82941c8ab6d1751.png" src="_images/ade7b1b7c1947493db3ddc15c6be9466bfcaa97563515c43a82941c8ab6d1751.png" />
<img alt="_images/03c6cc73df189d016f3e100b1ba182414e7222529fa5e5363ce4608419982393.png" src="_images/03c6cc73df189d016f3e100b1ba182414e7222529fa5e5363ce4608419982393.png" />
<img alt="_images/bb9b91d1bce447571c174827c3917d686af1ca07627aa3c6f844f1a5ac150c4d.png" src="_images/bb9b91d1bce447571c174827c3917d686af1ca07627aa3c6f844f1a5ac150c4d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_z, τ=7.0, pliegue=492
</pre></div>
</div>
<img alt="_images/30e0d33aae3e5d359228dbe8d6a6fa0c72b7d62d8634836d413b8bd8921e9306.png" src="_images/30e0d33aae3e5d359228dbe8d6a6fa0c72b7d62d8634836d413b8bd8921e9306.png" />
<img alt="_images/854a5480767bd09eb20008147a5f9cb45d72d8e41ffa1d270f665fe9a6ee1f3a.png" src="_images/854a5480767bd09eb20008147a5f9cb45d72d8e41ffa1d270f665fe9a6ee1f3a.png" />
<img alt="_images/b55a2ec15f9175715ddf9f9868423332b7d5c6284a18fb1dec01e8d3c0c553ae.png" src="_images/b55a2ec15f9175715ddf9f9868423332b7d5c6284a18fb1dec01e8d3c0c553ae.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_x, τ=7.0, pliegue=1215
</pre></div>
</div>
<img alt="_images/f17f4b449f152c5e97ca61e08e3d5dc1dce2727bd0d9dcc310c5e8c73f2371e5.png" src="_images/f17f4b449f152c5e97ca61e08e3d5dc1dce2727bd0d9dcc310c5e8c73f2371e5.png" />
<img alt="_images/9532dc84ef7fd6cb0880205738cfaefb74ee28011260301f8efd624ea1526f8c.png" src="_images/9532dc84ef7fd6cb0880205738cfaefb74ee28011260301f8efd624ea1526f8c.png" />
<img alt="_images/a79ac6ff0f7ba3c3c76614a226e6d8dfdb4c199a197a78f5b3d409549ed33eb6.png" src="_images/a79ac6ff0f7ba3c3c76614a226e6d8dfdb4c199a197a78f5b3d409549ed33eb6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_y, τ=7.0, pliegue=234
</pre></div>
</div>
<img alt="_images/15b25b32832dd5751ee133f8d5bc64597f978e17e33198f4c99881e6d7f10de9.png" src="_images/15b25b32832dd5751ee133f8d5bc64597f978e17e33198f4c99881e6d7f10de9.png" />
<img alt="_images/a506193e23f6bb50b2856ff354d5a849c24d08c1fe053e0671ebcd2504642646.png" src="_images/a506193e23f6bb50b2856ff354d5a849c24d08c1fe053e0671ebcd2504642646.png" />
<img alt="_images/0836defd74af4f145b70034a5af7a671bbc9f6a0dbebc3987d1ceb56bceaa2d2.png" src="_images/0836defd74af4f145b70034a5af7a671bbc9f6a0dbebc3987d1ceb56bceaa2d2.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_z, τ=21.0, pliegue=889
</pre></div>
</div>
<img alt="_images/2999739e1967ababaca1b4dcb6c81f3315ab9b358c8382326b1b5ac250c89236.png" src="_images/2999739e1967ababaca1b4dcb6c81f3315ab9b358c8382326b1b5ac250c89236.png" />
<img alt="_images/2109d5283361083c520ec3f5154da3cb32cebc57015df0e42a2ca6b12ba5f501.png" src="_images/2109d5283361083c520ec3f5154da3cb32cebc57015df0e42a2ca6b12ba5f501.png" />
<img alt="_images/23a9cb646b96b6e7ad5752e427e98a6fe3e63842668227837ba87521c9d6e5b1.png" src="_images/23a9cb646b96b6e7ad5752e427e98a6fe3e63842668227837ba87521c9d6e5b1.png" />
</div>
</div>
<p>Los gráficos de los residuos para las diferentes variables muestran ciertas desviaciones respecto a la línea de referencia, lo que sugiere que los residuos no siguen estrictamente una distribución normal. Las variables como <code class="docutils literal notranslate"><span class="pre">acc_x</span></code>, <code class="docutils literal notranslate"><span class="pre">acc_y</span></code> y <code class="docutils literal notranslate"><span class="pre">gyr_z</span></code> presentan un ajuste más cercano a la normalidad, con puntos alineados en su mayoría a la línea teórica, aunque hay ligeras desviaciones en los extremos. Esto es más evidente en algunas variables, donde la presencia de valores atípicos o comportamientos no lineales podrían estar influyendo en la calidad del ajuste.</p>
</section>
<section id="id1">
<h3>Boxplot<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>La visualización de los errores absolutos para los conjuntos de datos de entrenamiento, validación y prueba de las diferentes variables evaluadas. Se genera una tabla consolidada de errores de los mejores modelos anteriormente mostrados en la tabla y se presenta un gráfico de caja (boxplot) que resume la distribución de los errores por conjunto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errores_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando errores para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">)</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_best</span><span class="p">)</span>

    <span class="n">errores_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_train_best</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="p">)</span>
    <span class="n">errores_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_val_pred</span><span class="p">)</span>
    <span class="n">errores_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="p">)</span>

    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_train</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_val</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_test</span>
    <span class="p">])</span>

<span class="n">df_errores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errores_data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Set&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_errores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribución de Errores por Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error Absoluto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando errores para la variable: acc_x
Procesando errores para la variable: acc_y
Procesando errores para la variable: acc_z
Procesando errores para la variable: gyr_x
Procesando errores para la variable: gyr_y
Procesando errores para la variable: gyr_z
Procesando errores para la variable: mag_x
Procesando errores para la variable: mag_y
Procesando errores para la variable: mag_z
</pre></div>
</div>
<img alt="_images/c0a9e3e9157f12ca9383a92bc67caa2bb755ab0ec413a7af080facd0eca8e499.png" src="_images/c0a9e3e9157f12ca9383a92bc67caa2bb755ab0ec413a7af080facd0eca8e499.png" />
</div>
</div>
<p>Se observa que los errores absolutos en el conjunto de entrenamiento y validación son bajos y presentan una distribución consistente, con medianas cercanas y rangos intercuartílicos estrechos. Esto sugiere que el modelo tiene un buen desempeño en estos dos conjuntos, indicando que logra capturar patrones en los datos de manera adecuada sin evidenciar sobreajuste significativo. Sin embargo, el conjunto de prueba muestra una mayor dispersión en los errores, con una mediana más elevada y un rango intercuartílico amplio, lo que indica desafíos en la capacidad del modelo para generalizar a datos nuevos.</p>
</section>
</section>
<section id="regresion-ridge">
<h2>Regresion Ridge<a class="headerlink" href="#regresion-ridge" title="Link to this heading">#</a></h2>
<p>Evaluamos los mejores resultados para cada combinación de ejercicio y unidad en el conjunto de datos. El objetivo principal es ajustar y evaluar un modelo de regresión ridge para cada caso, considerando las divisiones temporales creadas previamente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_completos</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="k">for</span> <span class="n">ejercicio</span> <span class="ow">in</span> <span class="n">ejercicios</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">unidad</span> <span class="ow">in</span> <span class="n">unidades</span><span class="p">:</span>
        <span class="n">clave_entrenamiento</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;es</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">clave_prueba</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ts</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
   
        <span class="k">if</span> <span class="n">clave_entrenamiento</span> <span class="ow">in</span> <span class="n">datos_entrenamiento</span> <span class="ow">and</span> <span class="n">clave_prueba</span> <span class="ow">in</span> <span class="n">datos_prueba</span><span class="p">:</span>
            <span class="n">divisiones</span> <span class="o">=</span> <span class="n">crear_pliegues</span><span class="p">(</span>
                <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">clave_entrenamiento</span><span class="p">],</span>
                <span class="n">datos_prueba</span><span class="p">[</span><span class="n">clave_prueba</span><span class="p">],</span>
                <span class="n">variables</span><span class="p">,</span>
                <span class="n">tau_list</span>
            <span class="p">)</span>
            <span class="n">resultados</span> <span class="o">=</span> <span class="n">evaluar_modelo_ridge</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">)</span>
            <span class="n">mejor_resultado</span> <span class="o">=</span> <span class="n">obtener_mejores_resultados</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="n">criterio</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">)</span>
            <span class="n">resultados_completos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mejor_resultado</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Claves no encontradas: </span><span class="si">{</span><span class="n">clave_entrenamiento</span><span class="si">}</span><span class="s2"> o </span><span class="si">{</span><span class="n">clave_prueba</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h3>Mejores modelos<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados_completos</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ventana</th>
      <th>pliegue</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>R2</th>
      <th>Ljung-Box (p-value)</th>
      <th>Jarque-Bera (p-value)</th>
      <th>variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>254</th>
      <td>7.0</td>
      <td>255.0</td>
      <td>0.006749</td>
      <td>0.082150</td>
      <td>0.753867</td>
      <td>0.962056</td>
      <td>2.202011e-01</td>
      <td>7.313257e-01</td>
      <td>acc_x</td>
    </tr>
    <tr>
      <th>3604</th>
      <td>14.0</td>
      <td>1439.0</td>
      <td>0.020130</td>
      <td>0.141880</td>
      <td>1.518230</td>
      <td>0.972473</td>
      <td>5.161487e-01</td>
      <td>7.003042e-01</td>
      <td>acc_y</td>
    </tr>
    <tr>
      <th>7509</th>
      <td>28.0</td>
      <td>1075.0</td>
      <td>0.003701</td>
      <td>0.060834</td>
      <td>15.215547</td>
      <td>0.988402</td>
      <td>9.772105e-01</td>
      <td>1.624521e-18</td>
      <td>acc_z</td>
    </tr>
    <tr>
      <th>3356</th>
      <td>14.0</td>
      <td>1191.0</td>
      <td>0.000591</td>
      <td>0.024313</td>
      <td>44.092825</td>
      <td>0.751647</td>
      <td>2.056463e-01</td>
      <td>5.637408e-01</td>
      <td>gyr_x</td>
    </tr>
    <tr>
      <th>2691</th>
      <td>14.0</td>
      <td>526.0</td>
      <td>0.000316</td>
      <td>0.017771</td>
      <td>5.903995</td>
      <td>0.980688</td>
      <td>1.400305e-01</td>
      <td>9.832854e-01</td>
      <td>gyr_y</td>
    </tr>
    <tr>
      <th>3102</th>
      <td>14.0</td>
      <td>937.0</td>
      <td>0.006459</td>
      <td>0.080371</td>
      <td>9.722477</td>
      <td>0.921881</td>
      <td>3.892470e-04</td>
      <td>7.625570e-01</td>
      <td>gyr_z</td>
    </tr>
    <tr>
      <th>5469</th>
      <td>21.0</td>
      <td>1159.0</td>
      <td>0.000085</td>
      <td>0.009202</td>
      <td>11.059970</td>
      <td>0.995087</td>
      <td>4.216133e-08</td>
      <td>6.015002e-01</td>
      <td>mag_x</td>
    </tr>
    <tr>
      <th>5276</th>
      <td>21.0</td>
      <td>966.0</td>
      <td>0.000144</td>
      <td>0.011986</td>
      <td>1.749762</td>
      <td>0.983856</td>
      <td>9.916880e-04</td>
      <td>5.729994e-01</td>
      <td>mag_y</td>
    </tr>
    <tr>
      <th>4062</th>
      <td>14.0</td>
      <td>1897.0</td>
      <td>0.000003</td>
      <td>0.001629</td>
      <td>1.284298</td>
      <td>0.991375</td>
      <td>1.269594e-02</td>
      <td>6.367795e-01</td>
      <td>mag_z</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El análisis de las métricas refleja un desempeño sólido del modelo, con altos valores de (R^2) en variables como acc_x (0.962), acc_y (0.972), acc_z (0.988) y mag_x(0.995), lo que indica una excelente capacidad para explicar la variabilidad de los datos. Las métricas de error, como MSE y RMSE, se mantienen bajas en la mayoría de los casos, aunque valores elevados de MAPE en acc_z (15.22%) y gyr_x (44.09%) destacan áreas de mejora en precisión relativa. Las pruebas de Ljung-Box y Jarque-Bera confirman la independencia y normalidad de los residuos en la mayoría de las variables. En general, el modelo es predictivamente confiable.</p>
</section>
<section id="id3">
<h3>Residuos<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>Este fragmento de código se utiliza para analizar los residuos del mejor modelo identificado para cada variable, basándose en la mejor ventana temporal (τ) y el pliegue seleccionados previamente en los resultados completos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">resultados_completos</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
    <span class="n">mejor_tau</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Ventana&#39;</span><span class="p">]</span>
    <span class="n">mejor_pliegue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pliegue&#39;</span><span class="p">])</span>  

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generando gráfico de residuos para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">, τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">, pliegue=</span><span class="si">{</span><span class="n">mejor_pliegue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">X_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>


    <span class="n">modelo_best</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  
    <span class="n">modelo_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">,</span> <span class="n">y_train_best</span><span class="p">)</span>
    <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_pred_best</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)</span>

    <span class="c1"># Generar el gráfico para los residuos</span>
    <span class="n">graficar_diagnostico_residuos</span><span class="p">(</span>
        <span class="n">residuos_best</span><span class="p">,</span> 
        <span class="n">nombre_modelo</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mejor Modelo para </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> (τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_x, τ=7.0, pliegue=255
</pre></div>
</div>
<img alt="_images/37bff6313ea1bd578c057d9ee6724a523613611c2bec7b451aed16432349abdc.png" src="_images/37bff6313ea1bd578c057d9ee6724a523613611c2bec7b451aed16432349abdc.png" />
<img alt="_images/d51e9bf0e89e7639c3ec8b01c00302fdb398b5ab19f048fedfbe00e01576d8e4.png" src="_images/d51e9bf0e89e7639c3ec8b01c00302fdb398b5ab19f048fedfbe00e01576d8e4.png" />
<img alt="_images/b07dd2ca01a1cf48e30fbb1b735718103577ee17446e072d3dbdd195e1a3ed56.png" src="_images/b07dd2ca01a1cf48e30fbb1b735718103577ee17446e072d3dbdd195e1a3ed56.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_y, τ=14.0, pliegue=1439
</pre></div>
</div>
<img alt="_images/f792a3574cd12593710a845c0c1a851d43f0ede45b0b328be71ab5a4dd69c68d.png" src="_images/f792a3574cd12593710a845c0c1a851d43f0ede45b0b328be71ab5a4dd69c68d.png" />
<img alt="_images/bf984f08557789d8cbc6ea7d6e0971e5b0f63db66d4c51fbf9f18f3f73142438.png" src="_images/bf984f08557789d8cbc6ea7d6e0971e5b0f63db66d4c51fbf9f18f3f73142438.png" />
<img alt="_images/46c305df705ac7931f434dd3e3bb74cad8920a356fe26bc2e3f35e044c0b0720.png" src="_images/46c305df705ac7931f434dd3e3bb74cad8920a356fe26bc2e3f35e044c0b0720.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_z, τ=28.0, pliegue=1075
</pre></div>
</div>
<img alt="_images/139502a8ce2069c58c94af27c0a554819504cf575bfaa89fc17373a0990908a3.png" src="_images/139502a8ce2069c58c94af27c0a554819504cf575bfaa89fc17373a0990908a3.png" />
<img alt="_images/07236872d59da0da1664397fc328ab79960597f48cb340e86e9b98a7ad6856d3.png" src="_images/07236872d59da0da1664397fc328ab79960597f48cb340e86e9b98a7ad6856d3.png" />
<img alt="_images/553fb4ecefb84934a172f62bd8f2aba0015e0a9a2c5c46e66cb3fe331f598f59.png" src="_images/553fb4ecefb84934a172f62bd8f2aba0015e0a9a2c5c46e66cb3fe331f598f59.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_x, τ=14.0, pliegue=1191
</pre></div>
</div>
<img alt="_images/f5c287417b4d5f6e3220a5f2d6029cffc20b4a6e9a04f0d308ce3c8ce940a648.png" src="_images/f5c287417b4d5f6e3220a5f2d6029cffc20b4a6e9a04f0d308ce3c8ce940a648.png" />
<img alt="_images/1c1a24f18cbe647f88e9f58f1b9cdb80fac4fe3059221937ccbbd1b39aa50698.png" src="_images/1c1a24f18cbe647f88e9f58f1b9cdb80fac4fe3059221937ccbbd1b39aa50698.png" />
<img alt="_images/dc9ffcc61a21d546f6c4c3df727b5617cac812683b5df2739a0c2b66c05341be.png" src="_images/dc9ffcc61a21d546f6c4c3df727b5617cac812683b5df2739a0c2b66c05341be.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_y, τ=14.0, pliegue=526
</pre></div>
</div>
<img alt="_images/773c1512702b25d534945fafa27aa313a32a16cdd81e5d9c7a26b4fd98e38388.png" src="_images/773c1512702b25d534945fafa27aa313a32a16cdd81e5d9c7a26b4fd98e38388.png" />
<img alt="_images/531cc600a4c8132a303ed7b253d6a3a82f2d6972f9a0bd3ddee6ce7e5627feda.png" src="_images/531cc600a4c8132a303ed7b253d6a3a82f2d6972f9a0bd3ddee6ce7e5627feda.png" />
<img alt="_images/fb84a18b09fad12e64ab502b54ae53e188587301f81c73112f19363fb0068f74.png" src="_images/fb84a18b09fad12e64ab502b54ae53e188587301f81c73112f19363fb0068f74.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_z, τ=14.0, pliegue=937
</pre></div>
</div>
<img alt="_images/27ee706d948284b6b1a5bdf80e8683abfc00b0923d94a4538f3f2fcad4932488.png" src="_images/27ee706d948284b6b1a5bdf80e8683abfc00b0923d94a4538f3f2fcad4932488.png" />
<img alt="_images/66f8c1ed3d2a1acb14fa9e0fd1fed861a0acec7067ff3e483c127e15b0920c3a.png" src="_images/66f8c1ed3d2a1acb14fa9e0fd1fed861a0acec7067ff3e483c127e15b0920c3a.png" />
<img alt="_images/a561394db3e736f6884d9534e5b57cce298e426ac67ccb92231f949c6a762ace.png" src="_images/a561394db3e736f6884d9534e5b57cce298e426ac67ccb92231f949c6a762ace.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_x, τ=21.0, pliegue=1159
</pre></div>
</div>
<img alt="_images/5f710b906533b395d01d91d1b73cc475dfa61c03859ba97d732d067d37b38808.png" src="_images/5f710b906533b395d01d91d1b73cc475dfa61c03859ba97d732d067d37b38808.png" />
<img alt="_images/8e08cb2533992aa506b877a33ddabb96a9731e0b4d3745660400f7a01565cf71.png" src="_images/8e08cb2533992aa506b877a33ddabb96a9731e0b4d3745660400f7a01565cf71.png" />
<img alt="_images/4371a4bbed3867147e0da521da08207fb125d7d5dd9e3aabbd207dc4a2e37136.png" src="_images/4371a4bbed3867147e0da521da08207fb125d7d5dd9e3aabbd207dc4a2e37136.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_y, τ=21.0, pliegue=966
</pre></div>
</div>
<img alt="_images/05fa11b36cdff8314984dd51f5f9aeb069464e45dada1241a4d7a7e9715c0894.png" src="_images/05fa11b36cdff8314984dd51f5f9aeb069464e45dada1241a4d7a7e9715c0894.png" />
<img alt="_images/eb5a6ad09575b4533c2f8f156ee2ea0d73d09a2bd16bac53c33bfa2fcad30789.png" src="_images/eb5a6ad09575b4533c2f8f156ee2ea0d73d09a2bd16bac53c33bfa2fcad30789.png" />
<img alt="_images/1eb6f1bb3e3352c0e4e02e87f5048187004e7f3da29586311084172fe71dd1cd.png" src="_images/1eb6f1bb3e3352c0e4e02e87f5048187004e7f3da29586311084172fe71dd1cd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_z, τ=14.0, pliegue=1897
</pre></div>
</div>
<img alt="_images/d7784cbacb0f388b3cdd744f50f588a3bceabbb793741f03a3092f0303bc9aa9.png" src="_images/d7784cbacb0f388b3cdd744f50f588a3bceabbb793741f03a3092f0303bc9aa9.png" />
<img alt="_images/a388cc39d216b68d80d0e56530f55a0586bc87cc9e7186b8a227652178e4edd2.png" src="_images/a388cc39d216b68d80d0e56530f55a0586bc87cc9e7186b8a227652178e4edd2.png" />
<img alt="_images/e3edde81615337152a559f34a9c9c6342b947779ded63dcb761dbcca573df1f5.png" src="_images/e3edde81615337152a559f34a9c9c6342b947779ded63dcb761dbcca573df1f5.png" />
</div>
</div>
<p>Las gráficas de autocorrelación de residuos muestran que, en general, los residuos de las variables acc_x, acc_y, acc_z y gyr_x presentan independencia adecuada, con una rápida disminución de la autocorrelación dentro de las bandas de confianza. Sin embargo, en variables como mag_x, mag_y y gyr_z se observan autocorrelaciones significativas en ciertos lags. Sin embargo, para algunos modelos, la mayoría de los valores caen dentro de los intervalos de confianza, sugiriendo independencia residual adecuada.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errores_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando errores para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">)</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_best</span><span class="p">)</span>
    <span class="n">errores_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_train_best</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="p">)</span>
    <span class="n">errores_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_val_pred</span><span class="p">)</span>
    <span class="n">errores_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_test_best</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="p">)</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_train</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_val</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_test</span>
    <span class="p">])</span>
<span class="n">df_errores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errores_data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Set&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_errores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribución de Errores por Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error Absoluto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando errores para la variable: acc_x
Procesando errores para la variable: acc_y
Procesando errores para la variable: acc_z
Procesando errores para la variable: gyr_x
Procesando errores para la variable: gyr_y
Procesando errores para la variable: gyr_z
Procesando errores para la variable: mag_x
Procesando errores para la variable: mag_y
Procesando errores para la variable: mag_z
</pre></div>
</div>
<img alt="_images/fbd8cff9dba1d516c1f408751bb1d11b9d73faf434d455317b4cbdd44ad559da.png" src="_images/fbd8cff9dba1d516c1f408751bb1d11b9d73faf434d455317b4cbdd44ad559da.png" />
</div>
</div>
<p>La distribución de los errores absolutos en los conjuntos de entrenamiento, validación y prueba muestra consistencia general. El conjunto de entrenamiento presenta errores más bajos y concentrados, lo cual es esperable dado que el modelo se ajusta directamente a estos datos. En el conjunto de validación, los errores son más dispersos y las medianas ligeramente más altas, reflejando la capacidad del modelo para generalizar a datos no utilizados en el entrenamiento. En el conjunto de prueba, los errores vuelven a ser más controlados, indicando una estabilidad del modelo, aunque podría haber espacio para reducir la dispersión y mejorar la generalización.</p>
</section>
</section>
<section id="regresion-lasso">
<h2>Regresion Lasso<a class="headerlink" href="#regresion-lasso" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mejores_resultados_todasl</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="k">for</span> <span class="n">ejercicio</span> <span class="ow">in</span> <span class="n">ejercicios</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">unidad</span> <span class="ow">in</span> <span class="n">unidades</span><span class="p">:</span>
        <span class="n">clave_entrenamiento</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;es</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">clave_prueba</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ts</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
   
        <span class="k">if</span> <span class="n">clave_entrenamiento</span> <span class="ow">in</span> <span class="n">datos_entrenamiento</span> <span class="ow">and</span> <span class="n">clave_prueba</span> <span class="ow">in</span> <span class="n">datos_prueba</span><span class="p">:</span>
            <span class="n">divisiones</span> <span class="o">=</span> <span class="n">crear_pliegues</span><span class="p">(</span>
                <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">clave_entrenamiento</span><span class="p">],</span>
                <span class="n">datos_prueba</span><span class="p">[</span><span class="n">clave_prueba</span><span class="p">],</span>
                <span class="n">variables</span><span class="p">,</span>
                <span class="n">tau_list</span>
            <span class="p">)</span>
            <span class="n">resultados</span> <span class="o">=</span> <span class="n">evaluar_modelo_lasso</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">)</span>
            <span class="n">mejor_resultado</span> <span class="o">=</span> <span class="n">obtener_mejores_resultados</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="n">criterio</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">)</span>
            <span class="n">mejores_resultados_todasl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mejor_resultado</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Claves no encontradas: </span><span class="si">{</span><span class="n">clave_entrenamiento</span><span class="si">}</span><span class="s2"> o </span><span class="si">{</span><span class="n">clave_prueba</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mejores_resultados_todasl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ventana</th>
      <th>pliegue</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>R2</th>
      <th>Ljung-Box (p-value)</th>
      <th>Jarque-Bera (p-value)</th>
      <th>variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>976</th>
      <td>7.0</td>
      <td>977.0</td>
      <td>3.355536e-05</td>
      <td>0.005793</td>
      <td>3.483244</td>
      <td>0.848309</td>
      <td>0.559741</td>
      <td>0.857415</td>
      <td>acc_x</td>
    </tr>
    <tr>
      <th>446</th>
      <td>7.0</td>
      <td>447.0</td>
      <td>5.067933e-05</td>
      <td>0.007119</td>
      <td>0.060094</td>
      <td>0.930345</td>
      <td>0.633748</td>
      <td>0.759278</td>
      <td>acc_y</td>
    </tr>
    <tr>
      <th>4321</th>
      <td>21.0</td>
      <td>217.0</td>
      <td>1.465578e-03</td>
      <td>0.038283</td>
      <td>1.963413</td>
      <td>0.853109</td>
      <td>0.566631</td>
      <td>0.492015</td>
      <td>acc_z</td>
    </tr>
    <tr>
      <th>2273</th>
      <td>14.0</td>
      <td>211.0</td>
      <td>1.390810e-04</td>
      <td>0.011793</td>
      <td>75.373955</td>
      <td>0.757949</td>
      <td>0.316124</td>
      <td>0.609366</td>
      <td>gyr_x</td>
    </tr>
    <tr>
      <th>1295</th>
      <td>7.0</td>
      <td>1296.0</td>
      <td>1.692562e-06</td>
      <td>0.001301</td>
      <td>60.443322</td>
      <td>0.904552</td>
      <td>0.303081</td>
      <td>0.337948</td>
      <td>gyr_y</td>
    </tr>
    <tr>
      <th>0</th>
      <td>7.0</td>
      <td>1.0</td>
      <td>3.375896e-06</td>
      <td>0.001837</td>
      <td>26.880551</td>
      <td>0.763245</td>
      <td>0.533019</td>
      <td>0.693406</td>
      <td>gyr_z</td>
    </tr>
    <tr>
      <th>7010</th>
      <td>28.0</td>
      <td>885.0</td>
      <td>7.677107e-07</td>
      <td>0.000876</td>
      <td>0.143404</td>
      <td>0.882899</td>
      <td>0.222093</td>
      <td>0.950574</td>
      <td>mag_x</td>
    </tr>
    <tr>
      <th>7014</th>
      <td>28.0</td>
      <td>889.0</td>
      <td>8.180568e-07</td>
      <td>0.000904</td>
      <td>0.110830</td>
      <td>0.867582</td>
      <td>0.102318</td>
      <td>0.996736</td>
      <td>mag_y</td>
    </tr>
    <tr>
      <th>4318</th>
      <td>21.0</td>
      <td>214.0</td>
      <td>2.532963e-06</td>
      <td>0.001592</td>
      <td>1.032961</td>
      <td>0.923545</td>
      <td>0.075543</td>
      <td>0.643149</td>
      <td>mag_z</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mejores_resultados_todasl</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
    <span class="n">mejor_tau</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Ventana&#39;</span><span class="p">]</span>  
    <span class="n">mejor_pliegue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pliegue&#39;</span><span class="p">])</span> 

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generando gráfico de residuos para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">, τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">, pliegue=</span><span class="si">{</span><span class="n">mejor_pliegue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Recuperar los datos correspondientes al mejor modelo</span>
    <span class="n">X_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    
    <span class="n">modelo_best</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span> 
    <span class="n">modelo_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">,</span> <span class="n">y_train_best</span><span class="p">)</span>

    <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_pred_best</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)</span>

    <span class="n">graficar_diagnostico_residuos</span><span class="p">(</span>
        <span class="n">residuos_best</span><span class="p">,</span> 
        <span class="n">nombre_modelo</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mejor Modelo para </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> (τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_x, τ=7.0, pliegue=977
</pre></div>
</div>
<img alt="_images/7c527f4f8efdfea2de53bbc4e0260b7f3b71105c8ea370780e73efe0c7cc3ba6.png" src="_images/7c527f4f8efdfea2de53bbc4e0260b7f3b71105c8ea370780e73efe0c7cc3ba6.png" />
<img alt="_images/910d607110ed2e64e4e78e77bee0bdb9316cac973840f958eb5ac94a4ccdf126.png" src="_images/910d607110ed2e64e4e78e77bee0bdb9316cac973840f958eb5ac94a4ccdf126.png" />
<img alt="_images/8c9db241d455c40b7a28e166da8e4205a0896c21a40b77d57ead83f12ec572a8.png" src="_images/8c9db241d455c40b7a28e166da8e4205a0896c21a40b77d57ead83f12ec572a8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_y, τ=7.0, pliegue=447
</pre></div>
</div>
<img alt="_images/b17702ccf416e61f2bafa00845e69e33af8c700f84a2a36b9a8a2bfb66a451ed.png" src="_images/b17702ccf416e61f2bafa00845e69e33af8c700f84a2a36b9a8a2bfb66a451ed.png" />
<img alt="_images/da9504a7fc2e3b9b0c6ed01f2195b6d8590d41328a38628de316054fb3238605.png" src="_images/da9504a7fc2e3b9b0c6ed01f2195b6d8590d41328a38628de316054fb3238605.png" />
<img alt="_images/18eea37043ddf1652d5dc818738d7cf0851c7e2b37b90c5829f886dc15499c61.png" src="_images/18eea37043ddf1652d5dc818738d7cf0851c7e2b37b90c5829f886dc15499c61.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_z, τ=21.0, pliegue=217
</pre></div>
</div>
<img alt="_images/3fc18ea5dbc464a0cd87603745a305d8b586bcda00e55d1d6d26a79881a0e631.png" src="_images/3fc18ea5dbc464a0cd87603745a305d8b586bcda00e55d1d6d26a79881a0e631.png" />
<img alt="_images/4b1613679ce787f645d3d80fe1899f6f3b25ae450815cb9d79fa68147ea7c5b2.png" src="_images/4b1613679ce787f645d3d80fe1899f6f3b25ae450815cb9d79fa68147ea7c5b2.png" />
<img alt="_images/6de1ed5493e01da2dc5014b034eb4fdfd91227a67fcc39628d9580ce18c4a5bd.png" src="_images/6de1ed5493e01da2dc5014b034eb4fdfd91227a67fcc39628d9580ce18c4a5bd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_x, τ=14.0, pliegue=211
</pre></div>
</div>
<img alt="_images/ff47492816af226dd2d7741b2724496eb7a5ebaa2c16bb4b008db287de79f9f6.png" src="_images/ff47492816af226dd2d7741b2724496eb7a5ebaa2c16bb4b008db287de79f9f6.png" />
<img alt="_images/71bc8ca222bc2a6c6905a9c4287834022f96c27e454aeeeac0ea58148d2945a3.png" src="_images/71bc8ca222bc2a6c6905a9c4287834022f96c27e454aeeeac0ea58148d2945a3.png" />
<img alt="_images/69cdc722e618316e89c4cd2adc89f4f1708e9457193fc867d25ee6d26c2d40c6.png" src="_images/69cdc722e618316e89c4cd2adc89f4f1708e9457193fc867d25ee6d26c2d40c6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_y, τ=7.0, pliegue=1296
</pre></div>
</div>
<img alt="_images/ced7e39f0ab5fbbf5c35ec73be798cb098bcec0fcb2acca2b116886c45166f62.png" src="_images/ced7e39f0ab5fbbf5c35ec73be798cb098bcec0fcb2acca2b116886c45166f62.png" />
<img alt="_images/4905cfba0b2c2ac66dd1c88dcef89b7f687428f9448be981d2e78f1ac62b0a8b.png" src="_images/4905cfba0b2c2ac66dd1c88dcef89b7f687428f9448be981d2e78f1ac62b0a8b.png" />
<img alt="_images/4cefb54527d1696caefb63fdc362db5d25ecb01a8879de09d8de73eb0eb2b405.png" src="_images/4cefb54527d1696caefb63fdc362db5d25ecb01a8879de09d8de73eb0eb2b405.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_z, τ=7.0, pliegue=1
</pre></div>
</div>
<img alt="_images/0a78c4a1da080dbc9fdd0e55ee1345671497183e48102cba5e9aca5fea753436.png" src="_images/0a78c4a1da080dbc9fdd0e55ee1345671497183e48102cba5e9aca5fea753436.png" />
<img alt="_images/d77d900d8b682544e9ec426a2dcaba986f9455f73915f9ed3c1e4ca63df54051.png" src="_images/d77d900d8b682544e9ec426a2dcaba986f9455f73915f9ed3c1e4ca63df54051.png" />
<img alt="_images/2f9a1ac6e436b21e9edb3ba8716f2ec48dcaa291c4a443ad55dd4aa474bad1a6.png" src="_images/2f9a1ac6e436b21e9edb3ba8716f2ec48dcaa291c4a443ad55dd4aa474bad1a6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_x, τ=28.0, pliegue=885
</pre></div>
</div>
<img alt="_images/8ad6bc9849613028236cd30d6b058c198fd41cf9e0c67333b46b906f47112a84.png" src="_images/8ad6bc9849613028236cd30d6b058c198fd41cf9e0c67333b46b906f47112a84.png" />
<img alt="_images/d3471c13fa2a06b0b16a053fb5c6d49065320cb9c1a96bb1cffccc0f69561551.png" src="_images/d3471c13fa2a06b0b16a053fb5c6d49065320cb9c1a96bb1cffccc0f69561551.png" />
<img alt="_images/5df87a59c28ddc56b57d6aa5f8feda543470cbb9b7800ed3eb33a18bf51d20fe.png" src="_images/5df87a59c28ddc56b57d6aa5f8feda543470cbb9b7800ed3eb33a18bf51d20fe.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_y, τ=28.0, pliegue=889
</pre></div>
</div>
<img alt="_images/8bcc59c456a02b4f8c8d999e8b70c186b6bf35d8610bb03f366c64adb07d355e.png" src="_images/8bcc59c456a02b4f8c8d999e8b70c186b6bf35d8610bb03f366c64adb07d355e.png" />
<img alt="_images/773a12b40ba0e2b08138d0e17dfe7862e9bcb6f72ef9dcb8b7e9b554fb951322.png" src="_images/773a12b40ba0e2b08138d0e17dfe7862e9bcb6f72ef9dcb8b7e9b554fb951322.png" />
<img alt="_images/504d2e3f521ddf83aea26fd3f43f3863eb69effa63eafacb4c8859ecc4908a66.png" src="_images/504d2e3f521ddf83aea26fd3f43f3863eb69effa63eafacb4c8859ecc4908a66.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_z, τ=21.0, pliegue=214
</pre></div>
</div>
<img alt="_images/8e0451a78b3242b103e0d01e7977400d3ff343c6c60c96f7182c53241e617601.png" src="_images/8e0451a78b3242b103e0d01e7977400d3ff343c6c60c96f7182c53241e617601.png" />
<img alt="_images/05af3d2a3ad85875c52fc76dc2fd50e839c6db71bdccaed720cf21f0d7736282.png" src="_images/05af3d2a3ad85875c52fc76dc2fd50e839c6db71bdccaed720cf21f0d7736282.png" />
<img alt="_images/d657216130abc51d6b301a62e733f7c29399a4606a44af5423bd56c82cf9dc8e.png" src="_images/d657216130abc51d6b301a62e733f7c29399a4606a44af5423bd56c82cf9dc8e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">errores_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando errores para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">)</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_best</span><span class="p">)</span>
    <span class="n">errores_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_train_best</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="p">)</span>
    <span class="n">errores_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_val_pred</span><span class="p">)</span>
    <span class="n">errores_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_test_best</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="p">)</span>

    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_train</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_val</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_test</span>
    <span class="p">])</span>
<span class="n">df_errores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errores_data</span><span class="p">)</span>

<span class="c1"># Graficar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Set&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_errores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribución de Errores por Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error Absoluto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando errores para la variable: acc_x
Procesando errores para la variable: acc_y
Procesando errores para la variable: acc_z
Procesando errores para la variable: gyr_x
Procesando errores para la variable: gyr_y
Procesando errores para la variable: gyr_z
Procesando errores para la variable: mag_x
Procesando errores para la variable: mag_y
Procesando errores para la variable: mag_z
</pre></div>
</div>
<img alt="_images/e25d2e0653fd1a60e371599843c52b1c8ad9d0765e2e1c9021fb882638b4fd3e.png" src="_images/e25d2e0653fd1a60e371599843c52b1c8ad9d0765e2e1c9021fb882638b4fd3e.png" />
</div>
</div>
<p>La distribución de errores en esta gráfica muestra un comportamiento relativamente consistente entre los conjuntos de entrenamiento, validación y prueba. En el conjunto de entrenamiento, los errores son bajos y están concentrados, indicando un buen ajuste del modelo a los datos utilizados para aprender. En el conjunto de validación, la mediana de los errores es ligeramente superior y presenta una mayor dispersión, lo que refleja los desafíos del modelo al generalizar a nuevos datos. En el conjunto de prueba, los errores se estabilizan con valores similares a los del conjunto de validación, lo cual sugiere que el modelo mantiene un rendimiento adecuado cuando se enfrenta a datos no vistos previamente.</p>
</section>
<section id="regresion-random-forest">
<h2>Regresion Random Forest<a class="headerlink" href="#regresion-random-forest" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mejores_resultados_todasr</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="k">for</span> <span class="n">ejercicio</span> <span class="ow">in</span> <span class="n">ejercicios</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">unidad</span> <span class="ow">in</span> <span class="n">unidades</span><span class="p">:</span>
        <span class="n">clave_entrenamiento</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;es</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">clave_prueba</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ts</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
   
        <span class="k">if</span> <span class="n">clave_entrenamiento</span> <span class="ow">in</span> <span class="n">datos_entrenamiento</span> <span class="ow">and</span> <span class="n">clave_prueba</span> <span class="ow">in</span> <span class="n">datos_prueba</span><span class="p">:</span>
            <span class="n">divisiones</span> <span class="o">=</span> <span class="n">crear_pliegues</span><span class="p">(</span>
                <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">clave_entrenamiento</span><span class="p">],</span>
                <span class="n">datos_prueba</span><span class="p">[</span><span class="n">clave_prueba</span><span class="p">],</span>
                <span class="n">variables</span><span class="p">,</span>
                <span class="n">tau_list</span>
            <span class="p">)</span>
            <span class="n">resultados</span> <span class="o">=</span> <span class="n">evaluar_modelo_random</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">)</span>
            <span class="n">mejor_resultado</span> <span class="o">=</span> <span class="n">obtener_mejores_resultados</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="n">criterio</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">)</span>
            <span class="n">mejores_resultados_todasr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mejor_resultado</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Claves no encontradas: </span><span class="si">{</span><span class="n">clave_entrenamiento</span><span class="si">}</span><span class="s2"> o </span><span class="si">{</span><span class="n">clave_prueba</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mejores_resultados_todasr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ventana</th>
      <th>pliegue</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>R2</th>
      <th>Ljung-Box (p-value)</th>
      <th>Jarque-Bera (p-value)</th>
      <th>variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1067</th>
      <td>7.0</td>
      <td>1068.0</td>
      <td>2.681235e-05</td>
      <td>0.005178</td>
      <td>0.045861</td>
      <td>0.857172</td>
      <td>0.299696</td>
      <td>0.823697</td>
      <td>acc_x</td>
    </tr>
    <tr>
      <th>1069</th>
      <td>7.0</td>
      <td>1070.0</td>
      <td>1.099808e-04</td>
      <td>0.010487</td>
      <td>0.447239</td>
      <td>0.850039</td>
      <td>0.264913</td>
      <td>0.602990</td>
      <td>acc_y</td>
    </tr>
    <tr>
      <th>1411</th>
      <td>7.0</td>
      <td>1412.0</td>
      <td>1.014755e-04</td>
      <td>0.010074</td>
      <td>2.542835</td>
      <td>0.910195</td>
      <td>0.012032</td>
      <td>0.688411</td>
      <td>acc_z</td>
    </tr>
    <tr>
      <th>490</th>
      <td>7.0</td>
      <td>491.0</td>
      <td>2.706410e-05</td>
      <td>0.005202</td>
      <td>57.099402</td>
      <td>0.756746</td>
      <td>0.362452</td>
      <td>0.823565</td>
      <td>gyr_x</td>
    </tr>
    <tr>
      <th>788</th>
      <td>7.0</td>
      <td>789.0</td>
      <td>4.012621e-06</td>
      <td>0.002003</td>
      <td>147.023988</td>
      <td>0.738531</td>
      <td>0.122850</td>
      <td>0.803886</td>
      <td>gyr_y</td>
    </tr>
    <tr>
      <th>449</th>
      <td>7.0</td>
      <td>450.0</td>
      <td>2.646493e-06</td>
      <td>0.001627</td>
      <td>55.150237</td>
      <td>0.844151</td>
      <td>0.113946</td>
      <td>0.773975</td>
      <td>gyr_z</td>
    </tr>
    <tr>
      <th>252</th>
      <td>7.0</td>
      <td>253.0</td>
      <td>3.666305e-08</td>
      <td>0.000191</td>
      <td>0.028514</td>
      <td>0.860677</td>
      <td>0.909096</td>
      <td>0.645653</td>
      <td>mag_x</td>
    </tr>
    <tr>
      <th>1754</th>
      <td>7.0</td>
      <td>1755.0</td>
      <td>7.104373e-08</td>
      <td>0.000267</td>
      <td>0.046962</td>
      <td>0.787607</td>
      <td>0.723645</td>
      <td>0.761369</td>
      <td>mag_y</td>
    </tr>
    <tr>
      <th>1723</th>
      <td>7.0</td>
      <td>1724.0</td>
      <td>1.406184e-07</td>
      <td>0.000375</td>
      <td>0.516125</td>
      <td>0.696418</td>
      <td>0.790008</td>
      <td>0.764107</td>
      <td>mag_z</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Presentad buenos niveles de ajuste, especialmente en términos de los coeficientes (R^2), que indican una capacidad adecuada para explicar la variabilidad de los datos. En variables como acc_x ((R^2 = 0.857)), acc_y ((R^2 = 0.850)), y acc_z ((R^2 = 0.910)). Las métricas de error, como el MSE y RMSE, también permanecen en rangos bajos, lo que refuerza la precisión de las predicciones.</p>
<p>Por otro lado, los valores de las pruebas Ljung-Box y Jarque-Bera reflejan en su mayoría residuos bien distribuidos y no correlacionados. No obstante, ciertas variables, como acc_z ((p = 0.012) en Ljung-Box), pueden requerir una revisión más detallada para garantizar la independencia de los residuos.</p>
<section id="id4">
<h3>Residuos<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mejores_resultados_todasr</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
    <span class="n">mejor_tau</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Ventana&#39;</span><span class="p">]</span>  
    <span class="n">mejor_pliegue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pliegue&#39;</span><span class="p">])</span> 

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generando gráfico de residuos para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">, τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">, pliegue=</span><span class="si">{</span><span class="n">mejor_pliegue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">X_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">modelo_best</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span> 
    <span class="n">modelo_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">,</span> <span class="n">y_train_best</span><span class="p">)</span>

    <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_pred_best</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">residuos_best</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)]</span>  
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">residuos_best</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)]</span>  
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)</span>

    <span class="c1"># Generar el gráfico </span>
    <span class="n">graficar_diagnostico_residuos</span><span class="p">(</span>
        <span class="n">residuos_best</span><span class="p">,</span> 
        <span class="n">nombre_modelo</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mejor Modelo para </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> (τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_x, τ=7.0, pliegue=1068
</pre></div>
</div>
<img alt="_images/fd2053862d3b547e0f5bad6644d4f8e83f5f710a3adafd233d53182d7ee1b89d.png" src="_images/fd2053862d3b547e0f5bad6644d4f8e83f5f710a3adafd233d53182d7ee1b89d.png" />
<img alt="_images/1ba1e27c08f5f80e0b9e166b4a0d435e5ea0c2c88f72619d43a43ccd468d700a.png" src="_images/1ba1e27c08f5f80e0b9e166b4a0d435e5ea0c2c88f72619d43a43ccd468d700a.png" />
<img alt="_images/e6ad66038c64fda86a40b60808bb6a065d650124bd53408c6a4d658a4988ac10.png" src="_images/e6ad66038c64fda86a40b60808bb6a065d650124bd53408c6a4d658a4988ac10.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_y, τ=7.0, pliegue=1070
</pre></div>
</div>
<img alt="_images/de1fccf965b1ca724ecd6d57ef7eddb17ed876d6688cdfbc609d3e35a39faf1d.png" src="_images/de1fccf965b1ca724ecd6d57ef7eddb17ed876d6688cdfbc609d3e35a39faf1d.png" />
<img alt="_images/a764396ee3987f5df7cfa070c287ef79cfaebd4803018d361e8ed349ee373d21.png" src="_images/a764396ee3987f5df7cfa070c287ef79cfaebd4803018d361e8ed349ee373d21.png" />
<img alt="_images/a98597d524f36957913c373d65c0ee04702208c63dc30389871e930a4eeab6c0.png" src="_images/a98597d524f36957913c373d65c0ee04702208c63dc30389871e930a4eeab6c0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_z, τ=7.0, pliegue=1412
</pre></div>
</div>
<img alt="_images/386aef3ebc03a907025999372e8ed465c07765274260da15d85b55f814ebea8d.png" src="_images/386aef3ebc03a907025999372e8ed465c07765274260da15d85b55f814ebea8d.png" />
<img alt="_images/35605fa6f5ccf590ab4a6c39dcb0755c996ba41a0ae91a94a7a289f1349c6d8d.png" src="_images/35605fa6f5ccf590ab4a6c39dcb0755c996ba41a0ae91a94a7a289f1349c6d8d.png" />
<img alt="_images/0ab38e325676f387150acddbc8998f1f6281763775df69b7cb374fc44f0e5fd4.png" src="_images/0ab38e325676f387150acddbc8998f1f6281763775df69b7cb374fc44f0e5fd4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_x, τ=7.0, pliegue=491
</pre></div>
</div>
<img alt="_images/e7dfb080062b60a13166c22d1597fc92ee831db30f0b28a25601ec65cf39116f.png" src="_images/e7dfb080062b60a13166c22d1597fc92ee831db30f0b28a25601ec65cf39116f.png" />
<img alt="_images/aefb88f66776687f062327ffd902f570bc1d8e7e07151c7f4857c4a88bb9bbc6.png" src="_images/aefb88f66776687f062327ffd902f570bc1d8e7e07151c7f4857c4a88bb9bbc6.png" />
<img alt="_images/43a36478eaf1c0499caa1a33c667cea54ee0c6fcf59f7ab8fd3ac5d8445d6217.png" src="_images/43a36478eaf1c0499caa1a33c667cea54ee0c6fcf59f7ab8fd3ac5d8445d6217.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_y, τ=7.0, pliegue=789
</pre></div>
</div>
<img alt="_images/ce997dd23dde50decf5f35fc5045c9d11e50d6467cf3e2ad158983f8ca6080b6.png" src="_images/ce997dd23dde50decf5f35fc5045c9d11e50d6467cf3e2ad158983f8ca6080b6.png" />
<img alt="_images/084acc59efb35b82f88cad910f35119a7e921b7a27dcecdb3d915321f772b953.png" src="_images/084acc59efb35b82f88cad910f35119a7e921b7a27dcecdb3d915321f772b953.png" />
<img alt="_images/6576487d304bae9ff07a303c80a78a644d23e3114294f8855fc35b8dd37d548e.png" src="_images/6576487d304bae9ff07a303c80a78a644d23e3114294f8855fc35b8dd37d548e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_z, τ=7.0, pliegue=450
</pre></div>
</div>
<img alt="_images/318dc7f8029dc85c930b9bfd608da1d3d3757d668002dd11c8d11298b7c42c9d.png" src="_images/318dc7f8029dc85c930b9bfd608da1d3d3757d668002dd11c8d11298b7c42c9d.png" />
<img alt="_images/8039e70af7ef75a050e1de6f13726c536acfb59981f19840beb3a160010c31ef.png" src="_images/8039e70af7ef75a050e1de6f13726c536acfb59981f19840beb3a160010c31ef.png" />
<img alt="_images/62b026d39c1ea44c15882245ca11a383857f3f33cfb8fa69f2fb849ab6d388f1.png" src="_images/62b026d39c1ea44c15882245ca11a383857f3f33cfb8fa69f2fb849ab6d388f1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_x, τ=7.0, pliegue=253
</pre></div>
</div>
<img alt="_images/2268f7bc47368edd3122d4966accc3c15a0eef9b84f6dc7f5d820d3a6ffe14db.png" src="_images/2268f7bc47368edd3122d4966accc3c15a0eef9b84f6dc7f5d820d3a6ffe14db.png" />
<img alt="_images/5e8945e71b56f5ac03337c763bd8b302752123c22fa0a0d15621f249c0c6fbea.png" src="_images/5e8945e71b56f5ac03337c763bd8b302752123c22fa0a0d15621f249c0c6fbea.png" />
<img alt="_images/e648b3c4886dde4f6dc820b6cae22f3673accc26902f02a95c8490d1c9f87715.png" src="_images/e648b3c4886dde4f6dc820b6cae22f3673accc26902f02a95c8490d1c9f87715.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_y, τ=7.0, pliegue=1755
</pre></div>
</div>
<img alt="_images/4c0d92bec4972b0d5382fe480fb0f18fd249ec9a35c321d3ba4757f23297d918.png" src="_images/4c0d92bec4972b0d5382fe480fb0f18fd249ec9a35c321d3ba4757f23297d918.png" />
<img alt="_images/4954cff5c6e0fab00618f8470b5f2de15760e4b79d0c01fe56ae79fbaf08622e.png" src="_images/4954cff5c6e0fab00618f8470b5f2de15760e4b79d0c01fe56ae79fbaf08622e.png" />
<img alt="_images/bdf231688aedbd21446bc90d571cf20ec6c6560bdca9bb2e99c49ec4d59c39cf.png" src="_images/bdf231688aedbd21446bc90d571cf20ec6c6560bdca9bb2e99c49ec4d59c39cf.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_z, τ=7.0, pliegue=1724
</pre></div>
</div>
<img alt="_images/2831656181bf03c2c9ce3dd2a3549c68d33d2bbd9b797c44a23e8c10e9cc1507.png" src="_images/2831656181bf03c2c9ce3dd2a3549c68d33d2bbd9b797c44a23e8c10e9cc1507.png" />
<img alt="_images/a564a48f07b171cfbbe13f06cf488b04b1e3c4efa942ad978dd4396c7852c2cc.png" src="_images/a564a48f07b171cfbbe13f06cf488b04b1e3c4efa942ad978dd4396c7852c2cc.png" />
<img alt="_images/26eb4adecd92c56fe965019d5dd4e815b50aa5c2644fde7a722b908894557f1d.png" src="_images/26eb4adecd92c56fe965019d5dd4e815b50aa5c2644fde7a722b908894557f1d.png" />
</div>
</div>
<p>Los gráficos de las series de residuos muestran que, en general, los residuos se distribuyen alrededor de cero, lo que indica un buen ajuste de los modelos para las diferentes variables, como acc_x, acc_y, gyr_x, mag_x, entre otras. En algunos casos, como acc_y y gyr_y, los residuos presentan ligeras fluctuaciones, pero permanecen dentro de un rango aceptable, lo que no compromete la estabilidad del modelo. Los gráficos QQ-plot, por su parte, muestran que los residuos siguen de cerca la línea teórica, confirmando que la distribución de los mismos se aproxima a una normalidad, aunque con pequeñas desviaciones en los extremos superiores en ciertas variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errores_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando errores para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">)</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_best</span><span class="p">)</span>

    <span class="n">errores_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_train_best</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="p">)</span>
    <span class="n">errores_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_val_pred</span><span class="p">)</span>
    <span class="n">errores_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">y_test_pred</span><span class="o">-</span><span class="n">y_val_pred</span><span class="p">)</span>

    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_train</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_val</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_test</span>
    <span class="p">])</span>

<span class="n">df_errores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errores_data</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Set&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_errores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribución de Errores por Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error Absoluto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando errores para la variable: acc_x
Procesando errores para la variable: acc_y
Procesando errores para la variable: acc_z
Procesando errores para la variable: gyr_x
Procesando errores para la variable: gyr_y
Procesando errores para la variable: gyr_z
Procesando errores para la variable: mag_x
Procesando errores para la variable: mag_y
Procesando errores para la variable: mag_z
</pre></div>
</div>
<img alt="_images/5eccdd5e22510fd47ba4ca124407f06ef1b89681eef8427431ab286f5701d2bf.png" src="_images/5eccdd5e22510fd47ba4ca124407f06ef1b89681eef8427431ab286f5701d2bf.png" />
</div>
</div>
<p>En esta gráfica de distribución de errores por conjunto, se observa un comportamiento consistente en los errores entre los conjuntos de validación y prueba, lo que sugiere que el modelo tiene una buena capacidad de generalización a datos nuevos. Aunque el conjunto de entrenamiento presenta una mediana más baja, reflejando un ajuste preciso a los datos de entrenamiento, la proximidad de las medianas en validación y prueba indica que el modelo mantiene un desempeño estable en diferentes contextos.</p>
</section>
</section>
<section id="regresion-xgboost">
<h2>Regresion XGboost<a class="headerlink" href="#regresion-xgboost" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mejores_resultados_todasxg</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="k">for</span> <span class="n">ejercicio</span> <span class="ow">in</span> <span class="n">ejercicios</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">unidad</span> <span class="ow">in</span> <span class="n">unidades</span><span class="p">:</span>
        <span class="n">clave_entrenamiento</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;es</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">clave_prueba</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ts</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
   
        <span class="k">if</span> <span class="n">clave_entrenamiento</span> <span class="ow">in</span> <span class="n">datos_entrenamiento</span> <span class="ow">and</span> <span class="n">clave_prueba</span> <span class="ow">in</span> <span class="n">datos_prueba</span><span class="p">:</span>
            <span class="n">divisiones</span> <span class="o">=</span> <span class="n">crear_pliegues</span><span class="p">(</span>
                <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">clave_entrenamiento</span><span class="p">],</span>
                <span class="n">datos_prueba</span><span class="p">[</span><span class="n">clave_prueba</span><span class="p">],</span>
                <span class="n">variables</span><span class="p">,</span>
                <span class="n">tau_list</span>
            <span class="p">)</span>
            <span class="n">resultados</span> <span class="o">=</span> <span class="n">evaluar_modelo_xg</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">)</span>
            <span class="n">mejor_resultado</span> <span class="o">=</span> <span class="n">obtener_mejores_resultados</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="n">criterio</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">)</span>
            <span class="n">mejores_resultados_todasxg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mejor_resultado</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Claves no encontradas: </span><span class="si">{</span><span class="n">clave_entrenamiento</span><span class="si">}</span><span class="s2"> o </span><span class="si">{</span><span class="n">clave_prueba</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mejores_resultados_todasxg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ventana</th>
      <th>pliegue</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>R2</th>
      <th>Ljung-Box (p-value)</th>
      <th>Jarque-Bera (p-value)</th>
      <th>variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1714</th>
      <td>7.0</td>
      <td>1715.0</td>
      <td>9.305505e-05</td>
      <td>0.009647</td>
      <td>0.082443</td>
      <td>0.780278</td>
      <td>0.032279</td>
      <td>0.703898</td>
      <td>acc_x</td>
    </tr>
    <tr>
      <th>689</th>
      <td>7.0</td>
      <td>690.0</td>
      <td>6.157264e-04</td>
      <td>0.024814</td>
      <td>1.233322</td>
      <td>0.813733</td>
      <td>0.674536</td>
      <td>0.468225</td>
      <td>acc_y</td>
    </tr>
    <tr>
      <th>389</th>
      <td>7.0</td>
      <td>390.0</td>
      <td>5.825587e-05</td>
      <td>0.007633</td>
      <td>1.706207</td>
      <td>0.806649</td>
      <td>0.598902</td>
      <td>0.471495</td>
      <td>acc_z</td>
    </tr>
    <tr>
      <th>1625</th>
      <td>7.0</td>
      <td>1626.0</td>
      <td>7.776198e-06</td>
      <td>0.002789</td>
      <td>19.990486</td>
      <td>0.841859</td>
      <td>0.987813</td>
      <td>0.184064</td>
      <td>gyr_x</td>
    </tr>
    <tr>
      <th>2083</th>
      <td>7.0</td>
      <td>2084.0</td>
      <td>8.140288e-06</td>
      <td>0.002853</td>
      <td>82.900367</td>
      <td>0.840382</td>
      <td>0.175367</td>
      <td>0.666900</td>
      <td>gyr_y</td>
    </tr>
    <tr>
      <th>618</th>
      <td>7.0</td>
      <td>619.0</td>
      <td>2.131266e-05</td>
      <td>0.004617</td>
      <td>48.357831</td>
      <td>0.767003</td>
      <td>0.119394</td>
      <td>0.690551</td>
      <td>gyr_z</td>
    </tr>
    <tr>
      <th>801</th>
      <td>7.0</td>
      <td>802.0</td>
      <td>1.649117e-08</td>
      <td>0.000128</td>
      <td>0.016044</td>
      <td>0.767335</td>
      <td>0.751984</td>
      <td>0.538013</td>
      <td>mag_x</td>
    </tr>
    <tr>
      <th>535</th>
      <td>7.0</td>
      <td>536.0</td>
      <td>2.185597e-07</td>
      <td>0.000468</td>
      <td>0.073297</td>
      <td>0.648073</td>
      <td>0.510661</td>
      <td>0.842627</td>
      <td>mag_y</td>
    </tr>
    <tr>
      <th>1106</th>
      <td>7.0</td>
      <td>1107.0</td>
      <td>1.353200e-07</td>
      <td>0.000368</td>
      <td>0.397485</td>
      <td>0.748429</td>
      <td>0.718141</td>
      <td>0.904346</td>
      <td>mag_z</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo basado en XGBoost muestra un desempeño consistente, con valores aceptables en términos de MSE y RMSE para la mayoría de las variables, destacándose mag_x y mag_z con los menores errores absolutos y porcentuales (MAPE), lo que indica predicciones precisas en estas dimensiones. No obstante, las variables gyr_x, gyr_y, y gyr_z presentan MAPE más elevados, particularmente en gyr_y (82.90%), sugiriendo un impacto significativo de errores relativos que podría requerir optimización. Los coeficientes de determinación (R²) son buenos en general, superando 0.76 en la mayoría de los casos, aunque mag_y tiene un valor más bajo (R² = 0.65). Las pruebas de Ljung-Box indican poca o ninguna autocorrelación significativa en los residuos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mejores_resultados_todasxg</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
    <span class="n">mejor_tau</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Ventana&#39;</span><span class="p">]</span> 
    <span class="n">mejor_pliegue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pliegue&#39;</span><span class="p">])</span>  

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generando gráfico de residuos para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">, τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">, pliegue=</span><span class="si">{</span><span class="n">mejor_pliegue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">X_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">modelo_best</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  
    <span class="n">modelo_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">,</span> <span class="n">y_train_best</span><span class="p">)</span>

    <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_pred_best</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)</span>

    <span class="n">graficar_diagnostico_residuos</span><span class="p">(</span>
        <span class="n">residuos_best</span><span class="p">,</span> 
        <span class="n">nombre_modelo</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mejor Modelo para </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> (τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_x, τ=7.0, pliegue=1715
</pre></div>
</div>
<img alt="_images/9d7783cac9dcece4adc0446ba3a8d302dc8cbc9ec992f5000d808050683c5803.png" src="_images/9d7783cac9dcece4adc0446ba3a8d302dc8cbc9ec992f5000d808050683c5803.png" />
<img alt="_images/58f712ac1940e7d0ad8c348381a2f0480d8c00b7208cdcece1ff5c0fe65a2d23.png" src="_images/58f712ac1940e7d0ad8c348381a2f0480d8c00b7208cdcece1ff5c0fe65a2d23.png" />
<img alt="_images/03fef4b7176610c7d056072cb763ae411bb712a8c4af4eebd32c8a2a55fe8654.png" src="_images/03fef4b7176610c7d056072cb763ae411bb712a8c4af4eebd32c8a2a55fe8654.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_y, τ=7.0, pliegue=690
</pre></div>
</div>
<img alt="_images/b8759f5143b7061f3fc5a557e309a391c376ca11a50aec131808af8787028e70.png" src="_images/b8759f5143b7061f3fc5a557e309a391c376ca11a50aec131808af8787028e70.png" />
<img alt="_images/9307ea811885d549492ab779d235855d40cb9f36984f90464d74002a1da6b40c.png" src="_images/9307ea811885d549492ab779d235855d40cb9f36984f90464d74002a1da6b40c.png" />
<img alt="_images/1180c7f7fc9c0d506bd396afbf30407505a7229ce868c225481c10f80a2c36e6.png" src="_images/1180c7f7fc9c0d506bd396afbf30407505a7229ce868c225481c10f80a2c36e6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_z, τ=7.0, pliegue=390
</pre></div>
</div>
<img alt="_images/f288176306b44e9c014bc7a1cdb38e39871260430b114b49ad9f89c6e913b1a7.png" src="_images/f288176306b44e9c014bc7a1cdb38e39871260430b114b49ad9f89c6e913b1a7.png" />
<img alt="_images/3b3a8cbfde904a3b2d59d9bd4d7fce7475df05962e0b7e61b62b4680ca2dc733.png" src="_images/3b3a8cbfde904a3b2d59d9bd4d7fce7475df05962e0b7e61b62b4680ca2dc733.png" />
<img alt="_images/7e664fcaaf5cfd340e84c96400095499ca08ae9bd1ea78eb62d5a6cf23877b5b.png" src="_images/7e664fcaaf5cfd340e84c96400095499ca08ae9bd1ea78eb62d5a6cf23877b5b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_x, τ=7.0, pliegue=1626
</pre></div>
</div>
<img alt="_images/e80fc9302e62d5b163b5e0fecd17fed79d0ad63020825451c775a166cd8e1b9f.png" src="_images/e80fc9302e62d5b163b5e0fecd17fed79d0ad63020825451c775a166cd8e1b9f.png" />
<img alt="_images/e71ccabe85b25f31fda7317aa2108ee26b9eccf3bc63ed4f3b4f31927b6e5c62.png" src="_images/e71ccabe85b25f31fda7317aa2108ee26b9eccf3bc63ed4f3b4f31927b6e5c62.png" />
<img alt="_images/607a642d7bedced2368130fc2109e1a61b07308ab3f3d5d9086a227364b4766b.png" src="_images/607a642d7bedced2368130fc2109e1a61b07308ab3f3d5d9086a227364b4766b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_y, τ=7.0, pliegue=2084
</pre></div>
</div>
<img alt="_images/c1c31795bcbe40133f509cc7e9fb37a8468f66fd64053844f8dce0518489fbe6.png" src="_images/c1c31795bcbe40133f509cc7e9fb37a8468f66fd64053844f8dce0518489fbe6.png" />
<img alt="_images/3378e13e8b78dd461975c8ca42ff61b3584462c091d7cd1365a266333369b8b2.png" src="_images/3378e13e8b78dd461975c8ca42ff61b3584462c091d7cd1365a266333369b8b2.png" />
<img alt="_images/5641975c2690d09fabb5a28a29a4614a1c0022e2fa0cb882e49fa2ea1ee1a898.png" src="_images/5641975c2690d09fabb5a28a29a4614a1c0022e2fa0cb882e49fa2ea1ee1a898.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_z, τ=7.0, pliegue=619
</pre></div>
</div>
<img alt="_images/7555114629ac02037382c1cc49acf411211784a09a567aaa39b11bfc6d16929f.png" src="_images/7555114629ac02037382c1cc49acf411211784a09a567aaa39b11bfc6d16929f.png" />
<img alt="_images/bb3082a178fde5daddbdf5a0bd6a89cb4798860910fce7358d504ea187851b04.png" src="_images/bb3082a178fde5daddbdf5a0bd6a89cb4798860910fce7358d504ea187851b04.png" />
<img alt="_images/21ff07bd45c9079ed6905c6dc492406a3873e3f3fc9ad92bf48bb260525e0a0f.png" src="_images/21ff07bd45c9079ed6905c6dc492406a3873e3f3fc9ad92bf48bb260525e0a0f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_x, τ=7.0, pliegue=802
</pre></div>
</div>
<img alt="_images/fa21968eafd016fab6ba6e9d6a8628c2174ff4d614f617fb29f9354ab537f2fc.png" src="_images/fa21968eafd016fab6ba6e9d6a8628c2174ff4d614f617fb29f9354ab537f2fc.png" />
<img alt="_images/cb23c7ec7d9c169bda25409b7b19c20c75850e3aa45ea1d8d9ee7f65341c590f.png" src="_images/cb23c7ec7d9c169bda25409b7b19c20c75850e3aa45ea1d8d9ee7f65341c590f.png" />
<img alt="_images/65cfeca514ea4a2a456abacc117337d4b57f7cdf775a43d756eab1b6ea574555.png" src="_images/65cfeca514ea4a2a456abacc117337d4b57f7cdf775a43d756eab1b6ea574555.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_y, τ=7.0, pliegue=536
</pre></div>
</div>
<img alt="_images/2b50ea2b14886ddb3816c26386a6bea3fae9cbf3f4b45cf3942a99380f90c960.png" src="_images/2b50ea2b14886ddb3816c26386a6bea3fae9cbf3f4b45cf3942a99380f90c960.png" />
<img alt="_images/eda77d2243ed2016dd3593137fb82a9e3f9330ba466eea5fa1c5cdb4ee0a5a1f.png" src="_images/eda77d2243ed2016dd3593137fb82a9e3f9330ba466eea5fa1c5cdb4ee0a5a1f.png" />
<img alt="_images/b27c07097c9c7754ab495ca78ad36acdd853da4c35c29b8bdad2e12a3499eaa4.png" src="_images/b27c07097c9c7754ab495ca78ad36acdd853da4c35c29b8bdad2e12a3499eaa4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_z, τ=7.0, pliegue=1107
</pre></div>
</div>
<img alt="_images/8d8de53ce91ab3101e720c11378848b30bb3288fc9c68869228105004741a12a.png" src="_images/8d8de53ce91ab3101e720c11378848b30bb3288fc9c68869228105004741a12a.png" />
<img alt="_images/3575b37a6e95e634c3a1dc9766744463e36a91b8463a977bb0c90089084fb2cb.png" src="_images/3575b37a6e95e634c3a1dc9766744463e36a91b8463a977bb0c90089084fb2cb.png" />
<img alt="_images/73ec1aec1e1af0af0b76436710a911b94abb62ccacabf0f320de700654e99435.png" src="_images/73ec1aec1e1af0af0b76436710a911b94abb62ccacabf0f320de700654e99435.png" />
</div>
</div>
<p>El análisis de los gráficos de residuos para diferentes variables indica un comportamiento de normalidad en los residuos, aunque con algunas desviaciones notables. En la mayoría de los gráficos, los puntos se alinean bien con la línea roja que representa la distribución teórica esperada, lo que sugiere que los residuos siguen aproximadamente una distribución normal. Sin embargo, hay ligeras desviaciones en los extremos, especialmente en las variables acc_y, acc_z y gyr_y, lo que puede indicar la presencia de valores atípicos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errores_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando errores para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">)</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_best</span><span class="p">)</span>
    <span class="n">errores_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_train_best</span><span class="o">-</span> <span class="n">y_train_pred</span> <span class="p">)</span>
    <span class="n">errores_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_val_best</span> <span class="o">-</span><span class="n">y_val_pred</span> <span class="p">)</span>
    <span class="n">errores_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_test_best</span><span class="o">-</span> <span class="n">y_test_pred</span> <span class="p">)</span>

    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_train</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_val</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_test</span>
    <span class="p">])</span>
<span class="n">df_errores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errores_data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Set&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_errores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribución de Errores por Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error Absoluto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando errores para la variable: acc_x
Procesando errores para la variable: acc_y
Procesando errores para la variable: acc_z
Procesando errores para la variable: gyr_x
Procesando errores para la variable: gyr_y
Procesando errores para la variable: gyr_z
Procesando errores para la variable: mag_x
Procesando errores para la variable: mag_y
Procesando errores para la variable: mag_z
</pre></div>
</div>
<img alt="_images/5aa426eff42c4efffdb5eb7b75725bfa5dd1089b407aba49c72151d6042c9446.png" src="_images/5aa426eff42c4efffdb5eb7b75725bfa5dd1089b407aba49c72151d6042c9446.png" />
</div>
</div>
<p>Esta gráfica muestra una notable estabilidad en la distribución de los errores para los conjuntos de entrenamiento y validación, lo que indica que el modelo está logrando un ajuste balanceado sin signos evidentes de sobreajuste. Aunque el conjunto de prueba muestra una menor dispersión y valores más bajos de error absoluto, este comportamiento puede reflejar un buen desempeño en la predicción para datos nuevos.</p>
</section>
<section id="svr">
<h2>SVR<a class="headerlink" href="#svr" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mejores_resultados_todassvr</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="k">for</span> <span class="n">ejercicio</span> <span class="ow">in</span> <span class="n">ejercicios</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">unidad</span> <span class="ow">in</span> <span class="n">unidades</span><span class="p">:</span>
        <span class="n">clave_entrenamiento</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;es</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">clave_prueba</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ts</span><span class="si">{</span><span class="n">sujeto</span><span class="si">}</span><span class="s1">e</span><span class="si">{</span><span class="n">ejercicio</span><span class="si">}</span><span class="s1">u</span><span class="si">{</span><span class="n">unidad</span><span class="si">}</span><span class="s1">&#39;</span>
   
        <span class="k">if</span> <span class="n">clave_entrenamiento</span> <span class="ow">in</span> <span class="n">datos_entrenamiento</span> <span class="ow">and</span> <span class="n">clave_prueba</span> <span class="ow">in</span> <span class="n">datos_prueba</span><span class="p">:</span>
            <span class="n">divisiones</span> <span class="o">=</span> <span class="n">crear_pliegues</span><span class="p">(</span>
                <span class="n">datos_entrenamiento</span><span class="p">[</span><span class="n">clave_entrenamiento</span><span class="p">],</span>
                <span class="n">datos_prueba</span><span class="p">[</span><span class="n">clave_prueba</span><span class="p">],</span>
                <span class="n">variables</span><span class="p">,</span>
                <span class="n">tau_list</span>
            <span class="p">)</span>
            <span class="n">resultados</span> <span class="o">=</span> <span class="n">evaluar_modelo_svr</span><span class="p">(</span><span class="n">divisiones</span><span class="p">,</span> <span class="n">tau_list</span><span class="p">)</span>
            <span class="n">mejor_resultado</span> <span class="o">=</span> <span class="n">obtener_mejores_resultados</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="n">criterio</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">)</span>
            <span class="n">mejores_resultados_todassvr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mejor_resultado</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Claves no encontradas: </span><span class="si">{</span><span class="n">clave_entrenamiento</span><span class="si">}</span><span class="s2"> o </span><span class="si">{</span><span class="n">clave_prueba</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28

  Evaluación para τ = 7

  Evaluación para τ = 14

  Evaluación para τ = 21

  Evaluación para τ = 28
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mejores_resultados_todassvr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ventana</th>
      <th>pliegue</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>R2</th>
      <th>Ljung-Box (p-value)</th>
      <th>Jarque-Bera (p-value)</th>
      <th>variable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>444</th>
      <td>7.0</td>
      <td>445.0</td>
      <td>1.538085e-05</td>
      <td>0.003922</td>
      <td>0.036468</td>
      <td>0.807672</td>
      <td>0.048757</td>
      <td>0.781319</td>
      <td>acc_x</td>
    </tr>
    <tr>
      <th>446</th>
      <td>7.0</td>
      <td>447.0</td>
      <td>6.633672e-06</td>
      <td>0.002576</td>
      <td>0.052305</td>
      <td>0.892195</td>
      <td>0.416237</td>
      <td>0.471429</td>
      <td>acc_y</td>
    </tr>
    <tr>
      <th>2159</th>
      <td>14.0</td>
      <td>318.0</td>
      <td>1.691480e-04</td>
      <td>0.013006</td>
      <td>1.266143</td>
      <td>0.798279</td>
      <td>0.671806</td>
      <td>0.639221</td>
      <td>acc_z</td>
    </tr>
    <tr>
      <th>1296</th>
      <td>7.0</td>
      <td>1297.0</td>
      <td>5.917872e-05</td>
      <td>0.007693</td>
      <td>99.242069</td>
      <td>0.885675</td>
      <td>0.329027</td>
      <td>0.642500</td>
      <td>gyr_x</td>
    </tr>
    <tr>
      <th>1263</th>
      <td>7.0</td>
      <td>1264.0</td>
      <td>2.441409e-06</td>
      <td>0.001563</td>
      <td>70.352799</td>
      <td>0.772033</td>
      <td>0.637976</td>
      <td>0.703556</td>
      <td>gyr_y</td>
    </tr>
    <tr>
      <th>547</th>
      <td>7.0</td>
      <td>548.0</td>
      <td>6.476166e-06</td>
      <td>0.002545</td>
      <td>173.602530</td>
      <td>0.804501</td>
      <td>0.909089</td>
      <td>0.553311</td>
      <td>gyr_z</td>
    </tr>
    <tr>
      <th>1435</th>
      <td>7.0</td>
      <td>1436.0</td>
      <td>1.465631e-07</td>
      <td>0.000383</td>
      <td>0.047381</td>
      <td>0.749511</td>
      <td>0.396204</td>
      <td>0.663882</td>
      <td>mag_x</td>
    </tr>
    <tr>
      <th>5058</th>
      <td>21.0</td>
      <td>1396.0</td>
      <td>2.698405e-07</td>
      <td>0.000519</td>
      <td>0.196331</td>
      <td>0.919742</td>
      <td>0.722560</td>
      <td>0.796871</td>
      <td>mag_y</td>
    </tr>
    <tr>
      <th>6842</th>
      <td>28.0</td>
      <td>1380.0</td>
      <td>1.699271e-06</td>
      <td>0.001304</td>
      <td>0.702058</td>
      <td>0.914881</td>
      <td>0.138194</td>
      <td>0.000003</td>
      <td>mag_z</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo muestra un buen desempeño en términos de ajuste, destacando las variables mag_x y mag_y con los menores valores de MSE, RMSE y MAPE, además de altos coeficientes de determinación (R² &gt; 0.91), lo que indica predicciones muy precisas.  Los resultados de la prueba Ljung-Box indican que no hay autocorrelación significativa en la mayoría de los residuos, salvo en acc_x (p=0.048), donde podría requerirse mayor ajuste.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mejores_resultados_todassvr</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
    <span class="n">mejor_tau</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Ventana&#39;</span><span class="p">]</span>  
    <span class="n">mejor_pliegue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pliegue&#39;</span><span class="p">])</span>  
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generando gráfico de residuos para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">, τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">, pliegue=</span><span class="si">{</span><span class="n">mejor_pliegue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">X_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_train_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_train&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_val_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_val&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;X_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">y_test_best</span> <span class="o">=</span> <span class="n">divisiones</span><span class="p">[</span><span class="n">mejor_tau</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">][</span><span class="n">mejor_pliegue</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">modelo_best</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">modelo_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">,</span> <span class="n">y_train_best</span><span class="p">)</span>

    <span class="n">y_pred_best</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_pred_best</span>
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">residuos_best</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)]</span>  
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">residuos_best</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)]</span>  
    <span class="n">residuos_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuos_best</span><span class="p">)</span>

    <span class="n">graficar_diagnostico_residuos</span><span class="p">(</span>
        <span class="n">residuos_best</span><span class="p">,</span> 
        <span class="n">nombre_modelo</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mejor Modelo para </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> (τ=</span><span class="si">{</span><span class="n">mejor_tau</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_x, τ=7.0, pliegue=445
</pre></div>
</div>
<img alt="_images/cd8a3927a34db611515bce42aa2fcb4979755f67783573aa8c36a5f01a94f3ae.png" src="_images/cd8a3927a34db611515bce42aa2fcb4979755f67783573aa8c36a5f01a94f3ae.png" />
<img alt="_images/91a34d5d3e0e044cdf4f8f7099363c45326f0489ebea63b0989715c86571cce7.png" src="_images/91a34d5d3e0e044cdf4f8f7099363c45326f0489ebea63b0989715c86571cce7.png" />
<img alt="_images/b2475594453da7cc3b998750760184eeb31c0fac4ae8f7d817da353c314ad74a.png" src="_images/b2475594453da7cc3b998750760184eeb31c0fac4ae8f7d817da353c314ad74a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_y, τ=7.0, pliegue=447
</pre></div>
</div>
<img alt="_images/b59be0921044c2714daec9ccdc6b7cce1100e0301d6ffc6c1320d8b8414ed50c.png" src="_images/b59be0921044c2714daec9ccdc6b7cce1100e0301d6ffc6c1320d8b8414ed50c.png" />
<img alt="_images/07ded885b39175fdefdce7922cb9a196e57d9d985eb64f50422ca5552f2fbd19.png" src="_images/07ded885b39175fdefdce7922cb9a196e57d9d985eb64f50422ca5552f2fbd19.png" />
<img alt="_images/3f852d2f0e8e01c9bd8861a572d58c9c816495631112fcaf3989717d3fdb0ac0.png" src="_images/3f852d2f0e8e01c9bd8861a572d58c9c816495631112fcaf3989717d3fdb0ac0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: acc_z, τ=14.0, pliegue=318
</pre></div>
</div>
<img alt="_images/59cc6e9bd016a6b928b8b3a2dfa8fadb9e9fa8660cf04531c12021bf39f492fb.png" src="_images/59cc6e9bd016a6b928b8b3a2dfa8fadb9e9fa8660cf04531c12021bf39f492fb.png" />
<img alt="_images/d6df1791c48e9ddfb715b71927ff6748747235674e46b62ce4a87a1f77e0bc57.png" src="_images/d6df1791c48e9ddfb715b71927ff6748747235674e46b62ce4a87a1f77e0bc57.png" />
<img alt="_images/4257276942b2177346abe1681a03e16fa36b5833efa4a52060cc4aee82d6b465.png" src="_images/4257276942b2177346abe1681a03e16fa36b5833efa4a52060cc4aee82d6b465.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_x, τ=7.0, pliegue=1297
</pre></div>
</div>
<img alt="_images/559e3497427386d9c63b32cc4a0501ea49ba28fb2366615a5596c2dee91903ae.png" src="_images/559e3497427386d9c63b32cc4a0501ea49ba28fb2366615a5596c2dee91903ae.png" />
<img alt="_images/f671aa1e73c018b696d0e27e5a08bf348854db132e947d711e480ba4767e1ff9.png" src="_images/f671aa1e73c018b696d0e27e5a08bf348854db132e947d711e480ba4767e1ff9.png" />
<img alt="_images/c8e2a00520e286e64d5588872581a6972133abbd54b5a76fec38916611d88122.png" src="_images/c8e2a00520e286e64d5588872581a6972133abbd54b5a76fec38916611d88122.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_y, τ=7.0, pliegue=1264
</pre></div>
</div>
<img alt="_images/3b85803aaaf86647bd885667fa9d4aa11e8ef01c23763f0d92fd8c1bf918c2da.png" src="_images/3b85803aaaf86647bd885667fa9d4aa11e8ef01c23763f0d92fd8c1bf918c2da.png" />
<img alt="_images/561c30e5eaef3391fd6b688999cf679b96ec6d2ffb94449fe6d3ff25a71635c5.png" src="_images/561c30e5eaef3391fd6b688999cf679b96ec6d2ffb94449fe6d3ff25a71635c5.png" />
<img alt="_images/8ed64d26c61e2aca84036c5c39ea4cea726a53d80240064fc2cdf4179ae96e89.png" src="_images/8ed64d26c61e2aca84036c5c39ea4cea726a53d80240064fc2cdf4179ae96e89.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: gyr_z, τ=7.0, pliegue=548
</pre></div>
</div>
<img alt="_images/785f72c01f70ec05e6ffb882c6f5df8549fc53fc7b5d941f2faa1b6c2c574250.png" src="_images/785f72c01f70ec05e6ffb882c6f5df8549fc53fc7b5d941f2faa1b6c2c574250.png" />
<img alt="_images/b4002f697125287018976b552b58fa7f9b030ab19d3654d60fa023be982557b2.png" src="_images/b4002f697125287018976b552b58fa7f9b030ab19d3654d60fa023be982557b2.png" />
<img alt="_images/6f859f957ac463f121ee5b5d0fd4363e91f1836c052ee1f5d6f6d409e70a4ec8.png" src="_images/6f859f957ac463f121ee5b5d0fd4363e91f1836c052ee1f5d6f6d409e70a4ec8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_x, τ=7.0, pliegue=1436
</pre></div>
</div>
<img alt="_images/eb7b99a7f312f82a956f457ffdb1b20716298b339e860f8f61906495060f4704.png" src="_images/eb7b99a7f312f82a956f457ffdb1b20716298b339e860f8f61906495060f4704.png" />
<img alt="_images/38954eda2126fbc9d931127a3481ef36733e4afddcf9f9f581706e010f9f5223.png" src="_images/38954eda2126fbc9d931127a3481ef36733e4afddcf9f9f581706e010f9f5223.png" />
<img alt="_images/fe770fc86bd24a3ff0a0bb29e49531494e24e00bc6b7cf55da0d1ad434b9bc31.png" src="_images/fe770fc86bd24a3ff0a0bb29e49531494e24e00bc6b7cf55da0d1ad434b9bc31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_y, τ=21.0, pliegue=1396
</pre></div>
</div>
<img alt="_images/d4103159aeb6553b8af45390400541cd83377d44a0a2b1ce324f103d3be522ea.png" src="_images/d4103159aeb6553b8af45390400541cd83377d44a0a2b1ce324f103d3be522ea.png" />
<img alt="_images/487710e39810a864e812ce015395ecbb63137e763f051cdce0b7de48f1dfbc8b.png" src="_images/487710e39810a864e812ce015395ecbb63137e763f051cdce0b7de48f1dfbc8b.png" />
<img alt="_images/06d7ea160de3c464774325a98544ed9c06a562722f2be79500557cc9ac0a9a8f.png" src="_images/06d7ea160de3c464774325a98544ed9c06a562722f2be79500557cc9ac0a9a8f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generando gráfico de residuos para la variable: mag_z, τ=28.0, pliegue=1380
</pre></div>
</div>
<img alt="_images/f90963f2ed2db8c6b7add8517522d93512c15e93e21c508d4527cce1ef528c95.png" src="_images/f90963f2ed2db8c6b7add8517522d93512c15e93e21c508d4527cce1ef528c95.png" />
<img alt="_images/83a311ea11773c9d56230708ec3e8a2060d1388fd3f000e6b26644ab2239f4ad.png" src="_images/83a311ea11773c9d56230708ec3e8a2060d1388fd3f000e6b26644ab2239f4ad.png" />
<img alt="_images/8d183d129c101db134f584f8325a166090d891b0dfdb48e07f3e679f3799123e.png" src="_images/8d183d129c101db134f584f8325a166090d891b0dfdb48e07f3e679f3799123e.png" />
</div>
</div>
<p>Los residuos presentan valores predominantemente cercanos a cero, lo cual es deseable en un modelo bien ajustado. Sin embargo, en ciertas series se perciben fluctuaciones más pronunciadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errores_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando errores para la variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_best</span><span class="p">)</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_best</span><span class="p">)</span>
    <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">modelo_best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_best</span><span class="p">)</span>

    <span class="n">errores_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_train_best</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="p">)</span>
    <span class="n">errores_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_val_best</span> <span class="o">-</span> <span class="n">y_val_pred</span><span class="p">)</span>
    <span class="n">errores_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_test_best</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="p">)</span>

    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_train</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_val</span>
    <span class="p">])</span>
    <span class="n">errores_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;Set&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">}</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores_test</span>
    <span class="p">])</span>

<span class="n">df_errores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errores_data</span><span class="p">)</span>

<span class="c1"># Graficar los boxplots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Set&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_errores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribución de Errores por Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Conjunto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error Absoluto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando errores para la variable: acc_x
Procesando errores para la variable: acc_y
Procesando errores para la variable: acc_z
Procesando errores para la variable: gyr_x
Procesando errores para la variable: gyr_y
Procesando errores para la variable: gyr_z
Procesando errores para la variable: mag_x
Procesando errores para la variable: mag_y
Procesando errores para la variable: mag_z
</pre></div>
</div>
<img alt="_images/2d7170fb127a3609188564c0b06ddf01b33a7936286f5f54d3302096cc6ad8ec.png" src="_images/2d7170fb127a3609188564c0b06ddf01b33a7936286f5f54d3302096cc6ad8ec.png" />
</div>
</div>
<p>En esta gráfica se observa una distribución de errores relativamente balanceada entre los conjuntos de entrenamiento, validación y prueba. El conjunto de entrenamiento presenta los errores más bajos, lo cual es esperable ya que el modelo se ajusta directamente a estos datos. En el conjunto de validación, los errores son ligeramente más altos, lo que indica que el modelo mantiene un desempeño adecuado al generalizar sobre datos no vistos durante el entrenamiento. El conjunto de prueba muestra una distribución de errores similar al de validación, lo que sugiere que el modelo está generalizando bien y no está sobreajustado. Este comportamiento refleja un desempeño robusto y estable del modelo en diferentes conjuntos de datos.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="segundo_punto.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Ejercicios de Fisioterapia: EDA</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Ejercicio de Fisioterapia: Modelos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias">Librerias</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#funciones-para-los-modelos">Funciones para los modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizamos-los-pliegues">Visualizamos los pliegues</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementacion">Implementación</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#knn">KNN</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#los-mejores-modelos">Los mejores modelos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graficas-de-los-residuos">Graficas de los residuos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot">Boxplot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-lineal">Regresion Lineal</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mejores-modelos">Mejores Modelos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#residuos">Residuos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Boxplot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-ridge">Regresion Ridge</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Mejores modelos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Residuos</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-lasso">Regresion Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-random-forest">Regresion Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Residuos</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-xgboost">Regresion XGboost</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Henry Saenz y Kelly Beltran
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>